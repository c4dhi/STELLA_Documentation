"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[8685],{4844(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"deployment/production","title":"\ud83c\udfed Production","description":"Guide for deploying STELLA in production environments.","source":"@site/docs/deployment/production.md","sourceDirName":"deployment","slug":"/deployment/production","permalink":"/STELLA_backend/docs/deployment/production","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/deployment/production.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"\ud83c\udfed Production"}}');var l=s(4848),t=s(8453);const a={sidebar_position:2,title:"\ud83c\udfed Production"},r="\ud83c\udfed Production Deployment",o={},d=[{value:"Production Checklist",id:"production-checklist",level:2},{value:"Production Considerations",id:"production-considerations",level:2},{value:"Use a Real Kubernetes Cluster",id:"use-a-real-kubernetes-cluster",level:3},{value:"Use Managed PostgreSQL",id:"use-managed-postgresql",level:3},{value:"Secure Secrets",id:"secure-secrets",level:3},{value:"Enable SSL/TLS",id:"enable-ssltls",level:3},{value:"Configure Monitoring",id:"configure-monitoring",level:3},{value:"Autoscaling",id:"autoscaling",level:3},{value:"Deployment Modes",id:"deployment-modes",level:2},{value:"Background Mode",id:"background-mode",level:3},{value:"Monitoring Daemon",id:"monitoring-daemon",level:3},{value:"Environment Configuration",id:"environment-configuration",level:2},{value:"Production <code>.env</code>",id:"production-env",level:3},{value:"Frontend Production Build",id:"frontend-production-build",level:3},{value:"Using PM2",id:"using-pm2",level:2},{value:"Install PM2",id:"install-pm2",level:3},{value:"Start Services",id:"start-services",level:3},{value:"PM2 Management",id:"pm2-management",level:3},{value:"Using Systemd",id:"using-systemd",level:2},{value:"Create Service File",id:"create-service-file",level:3},{value:"Enable and Start",id:"enable-and-start",level:3},{value:"Health Checks",id:"health-checks",level:2},{value:"Backend Health Endpoint",id:"backend-health-endpoint",level:3},{value:"Kubernetes Probes",id:"kubernetes-probes",level:3},{value:"Backup Strategy",id:"backup-strategy",level:2},{value:"Database Backups",id:"database-backups",level:3},{value:"Configuration Backups",id:"configuration-backups",level:3},{value:"Rolling Updates",id:"rolling-updates",level:2},{value:"Security Hardening",id:"security-hardening",level:2},{value:"Network Policies",id:"network-policies",level:3},{value:"Pod Security",id:"pod-security",level:3},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"-production-deployment",children:"\ud83c\udfed Production Deployment"})}),"\n",(0,l.jsx)(n.p,{children:"Guide for deploying STELLA in production environments."}),"\n",(0,l.jsx)(n.h2,{id:"production-checklist",children:"Production Checklist"}),"\n",(0,l.jsx)(n.p,{children:"Before deploying to production:"}),"\n",(0,l.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","DNS records configured and verified"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","SSL certificates installed and auto-renewing"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Backend ",(0,l.jsx)(n.code,{children:".env"})," configured for production"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Frontend built with production URLs"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Nginx configuration tested"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Firewall allows ports 80, 443"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Services running with process manager (PM2/systemd)"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","CORS configured for specific domain"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Internal APIs not publicly accessible"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Monitoring and logging configured"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Backup strategy in place"]}),"\n",(0,l.jsxs)(n.li,{className:"task-list-item",children:[(0,l.jsx)(n.input,{type:"checkbox",disabled:!0})," ","All default passwords changed"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,l.jsx)(n.h3,{id:"use-a-real-kubernetes-cluster",children:"Use a Real Kubernetes Cluster"}),"\n",(0,l.jsx)(n.p,{children:"For production, use managed Kubernetes:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"GKE"})," (Google Kubernetes Engine)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"EKS"})," (Amazon Elastic Kubernetes Service)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"AKS"})," (Azure Kubernetes Service)"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"use-managed-postgresql",children:"Use Managed PostgreSQL"}),"\n",(0,l.jsx)(n.p,{children:"Replace the in-cluster PostgreSQL with a managed database:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Google Cloud SQL"}),"\n",(0,l.jsx)(n.li,{children:"Amazon RDS"}),"\n",(0,l.jsx)(n.li,{children:"Azure Database for PostgreSQL"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Update your connection string:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"DATABASE_URL=postgresql://user:password@your-managed-db.region.rds.amazonaws.com:5432/stella\n"})}),"\n",(0,l.jsx)(n.h3,{id:"secure-secrets",children:"Secure Secrets"}),"\n",(0,l.jsx)(n.p,{children:"Use a secrets management solution:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"HashiCorp Vault"}),"\n",(0,l.jsx)(n.li,{children:"AWS Secrets Manager"}),"\n",(0,l.jsx)(n.li,{children:"Google Secret Manager"}),"\n",(0,l.jsx)(n.li,{children:"Azure Key Vault"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"enable-ssltls",children:"Enable SSL/TLS"}),"\n",(0,l.jsx)(n.p,{children:"All services should use TLS:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Backend\nPUBLIC_SERVER_URL=https://api.yourdomain.com\nPUBLIC_LIVEKIT_URL=wss://livekit.yourdomain.com\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configure-monitoring",children:"Configure Monitoring"}),"\n",(0,l.jsx)(n.p,{children:"Set up observability:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Prometheus"})," for metrics"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Grafana"})," for dashboards"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Loki"})," or ",(0,l.jsx)(n.strong,{children:"ELK"})," for logs"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"Jaeger"})," for tracing"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"autoscaling",children:"Autoscaling"}),"\n",(0,l.jsx)(n.p,{children:"Configure Horizontal Pod Autoscaler:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: autoscaling/v2\nkind: HorizontalPodAutoscaler\nmetadata:\n  name: backend-hpa\n  namespace: ai-agents\nspec:\n  scaleTargetRef:\n    apiVersion: apps/v1\n    kind: Deployment\n    name: session-management-server\n  minReplicas: 2\n  maxReplicas: 10\n  metrics:\n    - type: Resource\n      resource:\n        name: cpu\n        target:\n          type: Utilization\n          averageUtilization: 70\n"})}),"\n",(0,l.jsx)(n.h2,{id:"deployment-modes",children:"Deployment Modes"}),"\n",(0,l.jsx)(n.h3,{id:"background-mode",children:"Background Mode"}),"\n",(0,l.jsx)(n.p,{children:"Run STELLA in daemon mode for production:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"./scripts/start-k8s.sh --production --daemon\n"})}),"\n",(0,l.jsx)(n.p,{children:"This:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Runs in the background"}),"\n",(0,l.jsx)(n.li,{children:"Survives SSH logout"}),"\n",(0,l.jsx)(n.li,{children:"Automatically restarts on failure"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"monitoring-daemon",children:"Monitoring Daemon"}),"\n",(0,l.jsx)(n.p,{children:"Check daemon status:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# View logs\ntail -f /tmp/stella-ai-k8s/stella-ai-k8s.log\n\n# Check port-forwards\n./scripts/monitor-port-forwards.sh --status\n"})}),"\n",(0,l.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,l.jsxs)(n.h3,{id:"production-env",children:["Production ",(0,l.jsx)(n.code,{children:".env"})]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Server\nNODE_ENV=production\nPORT=3000\n\n# Database\nDATABASE_URL=postgresql://user:password@managed-db:5432/stella\n\n# LiveKit (external service)\nLIVEKIT_URL=wss://livekit.yourdomain.com\nPUBLIC_LIVEKIT_URL=wss://livekit.yourdomain.com\nLIVEKIT_API_KEY=your-production-key\nLIVEKIT_API_SECRET=your-production-secret\n\n# CORS\nCORS_ORIGIN=https://yourdomain.com\n\n# Public URLs\nPUBLIC_SERVER_URL=https://api.yourdomain.com\n\n# Agent Configuration\nAGENT_IMAGE=your-registry.com/stella-agent:v1.0.0\nKUBERNETES_NAMESPACE=ai-agents\n"})}),"\n",(0,l.jsx)(n.h3,{id:"frontend-production-build",children:"Frontend Production Build"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cd frontend-ui\n\n# Create production environment\ncat > .env.production << EOF\nVITE_API_URL=https://api.yourdomain.com\nVITE_LIVEKIT_URL=wss://livekit.yourdomain.com\nEOF\n\n# Build for production\nnpm run build\n"})}),"\n",(0,l.jsx)(n.h2,{id:"using-pm2",children:"Using PM2"}),"\n",(0,l.jsx)(n.p,{children:"For non-Kubernetes deployments, use PM2:"}),"\n",(0,l.jsx)(n.h3,{id:"install-pm2",children:"Install PM2"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"npm install -g pm2\n"})}),"\n",(0,l.jsx)(n.h3,{id:"start-services",children:"Start Services"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Backend\ncd session-management-server\npm2 start npm --name "stella-backend" -- run start:prod\n\n# Frontend (serve built files)\nnpm install -g serve\npm2 start "serve -s dist -l 8080" --name "stella-frontend"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"pm2-management",children:"PM2 Management"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# View status\npm2 status\n\n# View logs\npm2 logs stella-backend\n\n# Restart\npm2 restart stella-backend\n\n# Save configuration\npm2 save\n\n# Setup startup script\npm2 startup\n"})}),"\n",(0,l.jsx)(n.h2,{id:"using-systemd",children:"Using Systemd"}),"\n",(0,l.jsx)(n.p,{children:"Alternative to PM2 for Linux servers:"}),"\n",(0,l.jsx)(n.h3,{id:"create-service-file",children:"Create Service File"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-ini",children:"# /etc/systemd/system/stella-backend.service\n[Unit]\nDescription=STELLA Backend\nAfter=network.target\n\n[Service]\nType=simple\nUser=www-data\nWorkingDirectory=/opt/stella/session-management-server\nEnvironment=NODE_ENV=production\nExecStart=/usr/bin/node dist/main.js\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,l.jsx)(n.h3,{id:"enable-and-start",children:"Enable and Start"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\nsudo systemctl enable stella-backend\nsudo systemctl start stella-backend\nsudo systemctl status stella-backend\n"})}),"\n",(0,l.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,l.jsx)(n.h3,{id:"backend-health-endpoint",children:"Backend Health Endpoint"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"curl https://api.yourdomain.com/health\n"})}),"\n",(0,l.jsx)(n.h3,{id:"kubernetes-probes",children:"Kubernetes Probes"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"livenessProbe:\n  httpGet:\n    path: /health\n    port: 3000\n  initialDelaySeconds: 30\n  periodSeconds: 10\n\nreadinessProbe:\n  httpGet:\n    path: /health\n    port: 3000\n  initialDelaySeconds: 5\n  periodSeconds: 5\n"})}),"\n",(0,l.jsx)(n.h2,{id:"backup-strategy",children:"Backup Strategy"}),"\n",(0,l.jsx)(n.h3,{id:"database-backups",children:"Database Backups"}),"\n",(0,l.jsx)(n.p,{children:"Set up automated PostgreSQL backups:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Daily backup script\npg_dump -h localhost -U stella stella_db > backup_$(date +%Y%m%d).sql\n\n# Upload to cloud storage\naws s3 cp backup_$(date +%Y%m%d).sql s3://your-backups/stella/\n"})}),"\n",(0,l.jsx)(n.h3,{id:"configuration-backups",children:"Configuration Backups"}),"\n",(0,l.jsx)(n.p,{children:"Version control all configuration:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Kubernetes manifests"}),"\n",(0,l.jsx)(n.li,{children:"Nginx configuration"}),"\n",(0,l.jsx)(n.li,{children:"Environment templates (not secrets)"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"rolling-updates",children:"Rolling Updates"}),"\n",(0,l.jsx)(n.p,{children:"Deploy new versions without downtime:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Update image\nkubectl set image deployment/session-management-server \\\n  session-management-server=your-registry/stella-backend:v2.0.0 \\\n  -n ai-agents\n\n# Monitor rollout\nkubectl rollout status deployment/session-management-server -n ai-agents\n\n# Rollback if needed\nkubectl rollout undo deployment/session-management-server -n ai-agents\n"})}),"\n",(0,l.jsx)(n.h2,{id:"security-hardening",children:"Security Hardening"}),"\n",(0,l.jsx)(n.h3,{id:"network-policies",children:"Network Policies"}),"\n",(0,l.jsx)(n.p,{children:"Restrict pod communication:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: backend-policy\n  namespace: ai-agents\nspec:\n  podSelector:\n    matchLabels:\n      app: session-management-server\n  policyTypes:\n    - Ingress\n    - Egress\n  ingress:\n    - from:\n        - namespaceSelector:\n            matchLabels:\n              name: ingress-nginx\n      ports:\n        - port: 3000\n"})}),"\n",(0,l.jsx)(n.h3,{id:"pod-security",children:"Pod Security"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"securityContext:\n  runAsNonRoot: true\n  runAsUser: 1000\n  readOnlyRootFilesystem: true\n  allowPrivilegeEscalation: false\n"})}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/deployment/nginx-setup",children:"Nginx Setup"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/deployment/reverse-proxy",children:"Reverse Proxy"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/docs/integration/livekit-production",children:"LiveKit Production"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453(e,n,s){s.d(n,{R:()=>a,x:()=>r});var i=s(6540);const l={},t=i.createContext(l);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);