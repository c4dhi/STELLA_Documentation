"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[1968],{2076(e,n,s){s.d(n,{gj:()=>l,pn:()=>r});s(6540);var i=s(7714),t=s(4848);function r({number:e,title:n,children:s,code:r,language:l="bash",isLast:a=!1}){return(0,t.jsxs)("div",{className:"step",children:[(0,t.jsxs)("div",{className:"step__indicator",children:[(0,t.jsx)("div",{className:"step__number",children:e}),!a&&(0,t.jsx)("div",{className:"step__connector"})]}),(0,t.jsxs)("div",{className:"step__body",children:[(0,t.jsx)("h3",{className:"step__title",children:n}),(0,t.jsx)("div",{className:"step__content",children:s}),r&&(0,t.jsx)("div",{className:"step__code",children:(0,t.jsx)(i.A,{language:l,children:r})})]})]})}function l({children:e}){return(0,t.jsx)("div",{className:"steps",children:e})}},4137(e,n,s){s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>x,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"deployment/kubernetes","title":"Kubernetes","description":"This guide explains how to deploy the STELLA system to Kubernetes.","source":"@site/docs/deployment/kubernetes.md","sourceDirName":"deployment","slug":"/deployment/kubernetes","permalink":"/STELLA_backend/docs/deployment/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/deployment/kubernetes.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"title":"Kubernetes"},"sidebar":"docsSidebar","previous":{"title":"TypeScript Types","permalink":"/STELLA_backend/docs/sdk/typescript-types"},"next":{"title":"Nginx Setup","permalink":"/STELLA_backend/docs/deployment/nginx-setup"}}');var t=s(4848),r=s(8453),l=s(7054);const a={sidebar_position:1,title:"Kubernetes"},d="Kubernetes Deployment",o={},c=[{value:"Architecture",id:"architecture",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Required Software",id:"required-software",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Quick Start",id:"quick-start",level:2},{value:"Deploy Everything",id:"deploy-everything",level:3},{value:"Access the System",id:"access-the-system",level:3},{value:"Components",id:"components",level:2},{value:"PostgreSQL",id:"postgresql",level:3},{value:"LiveKit Server (if self-hosted)",id:"livekit-server-if-self-hosted",level:3},{value:"Session Management Server",id:"session-management-server",level:3},{value:"AI Agent Pods (On-Demand)",id:"ai-agent-pods-on-demand",level:3},{value:"Useful Commands",id:"useful-commands",level:2},{value:"View Resources",id:"view-resources",level:3},{value:"Database Access",id:"database-access",level:3},{value:"Scaling",id:"scaling",level:3},{value:"Resource Limits",id:"resource-limits",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"minikube Won&#39;t Start",id:"minikube-wont-start",level:3},{value:"Pods Stuck in ImagePullBackOff",id:"pods-stuck-in-imagepullbackoff",level:3},{value:"Backend Can&#39;t Create Agent Pods",id:"backend-cant-create-agent-pods",level:3},{value:"Agent Pod Fails to Start",id:"agent-pod-fails-to-start",level:3},{value:"Database Migration Fails",id:"database-migration-fails",level:3},{value:"Stopping the Cluster",id:"stopping-the-cluster",level:2},{value:"Stop Port Forwarding",id:"stop-port-forwarding",level:3},{value:"Stop minikube",id:"stop-minikube",level:3},{value:"Delete Everything",id:"delete-everything",level:3},{value:"Development Workflow",id:"development-workflow",level:2},{value:"Make Code Changes",id:"make-code-changes",level:3},{value:"Rebuild Images",id:"rebuild-images",level:3},{value:"Restart Deployment",id:"restart-deployment",level:3},{value:"View Logs",id:"view-logs",level:3},{value:"See Also",id:"see-also",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes-deployment",children:"Kubernetes Deployment"})}),"\n",(0,t.jsx)(n.p,{children:"This guide explains how to deploy the STELLA system to Kubernetes."}),"\n",(0,t.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Kubernetes Cluster                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                   Namespace: ai-agents                 \u2502  \u2502\n\u2502  \u2502                                                         \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502\n\u2502  \u2502  \u2502  PostgreSQL  \u2502  \u2502   LiveKit    \u2502  \u2502   Backend    \u2502 \u2502  \u2502\n\u2502  \u2502  \u2502     :5432    \u2502  \u2502    :7880     \u2502  \u2502    API       \u2502 \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502    :3000     \u2502 \u2502  \u2502\n\u2502  \u2502                                       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502\n\u2502  \u2502                                                         \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502\n\u2502  \u2502  \u2502        AI Agent Pods (Created On-Demand)         \u2502 \u2502  \u2502\n\u2502  \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502 \u2502  \u2502\n\u2502  \u2502  \u2502  \u2502 Agent 1 \u2502  \u2502 Agent 2 \u2502  \u2502 Agent 3 \u2502  ...     \u2502 \u2502  \u2502\n\u2502  \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502 \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n          \u2191                                     \u2191\n    Port Forward                          Port Forward\n    localhost:3000                      localhost:7880\n"})}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.h3,{id:"required-software",children:"Required Software"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Software"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Installation"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Docker"}),(0,t.jsx)(n.td,{children:"Container runtime"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"https://docker.com/products/docker-desktop",children:"Docker Desktop"})," or ",(0,t.jsx)(n.a,{href:"https://orbstack.dev",children:"OrbStack"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"kubectl"}),(0,t.jsx)(n.td,{children:"Kubernetes CLI"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"brew install kubectl"})," (macOS)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"minikube"}),(0,t.jsx)(n.td,{children:"Local Kubernetes"}),(0,t.jsx)(n.td,{children:"Auto-installed by script"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Create a ",(0,t.jsx)(n.code,{children:".env"})," file with your credentials:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"cp .env.example .env\nnano .env\n"})}),"\n",(0,t.jsx)(n.p,{children:"Set your essential Kubernetes deployment credentials:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# AI APIs\nOPENAI_API_KEY=sk-proj-xxxxxxxxxxxxx\n\n# LiveKit (WebRTC)\nLIVEKIT_URL=wss://your-livekit-server.com\nLIVEKIT_API_KEY=your-api-key\nLIVEKIT_API_SECRET=your-api-secret\n"})}),"\n",(0,t.jsx)(l.Ey,{category:"kubernetes",text:"Kubernetes Environment Variables",description:"See namespace configuration, DNS settings, and other K8s-specific options."}),"\n",(0,t.jsx)(n.admonition,{title:"Security",type:"caution",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:".env"})," file is gitignored. Your credentials stay local and are injected into Kubernetes secrets during deployment."]})}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.h3,{id:"deploy-everything",children:"Deploy Everything"}),"\n",(0,t.jsx)(n.p,{children:"Run the all-in-one startup script:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"./scripts/start-k8s.sh\n"})}),"\n",(0,t.jsx)(n.p,{children:"This script will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Check Docker is running"}),"\n",(0,t.jsx)(n.li,{children:"Install minikube (if needed)"}),"\n",(0,t.jsx)(n.li,{children:"Start minikube cluster"}),"\n",(0,t.jsx)(n.li,{children:"Build Docker images"}),"\n",(0,t.jsx)(n.li,{children:"Deploy PostgreSQL, LiveKit, and Backend"}),"\n",(0,t.jsx)(n.li,{children:"Wait for all services to be ready"}),"\n",(0,t.jsx)(n.li,{children:"Start port forwarding"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"access-the-system",children:"Access the System"}),"\n",(0,t.jsx)(n.p,{children:"Once deployed:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Service"}),(0,t.jsx)(n.th,{children:"URL"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Backend API"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"http://localhost:3000",children:"http://localhost:3000"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LiveKit"}),(0,t.jsx)(n.td,{children:"ws://localhost:7880"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Frontend"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"http://localhost:5173",children:"http://localhost:5173"})})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"components",children:"Components"}),"\n",(0,t.jsx)(n.h3,{id:"postgresql",children:"PostgreSQL"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Deployment"}),": ",(0,t.jsx)(n.code,{children:"postgres"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Service"}),": ",(0,t.jsx)(n.code,{children:"postgres:5432"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Storage"}),": 10Gi PersistentVolumeClaim"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Credentials"}),": Configured via environment"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/docs/architecture/database",children:"Database Schema"})," for the complete data model."]}),"\n",(0,t.jsx)(n.h3,{id:"livekit-server-if-self-hosted",children:"LiveKit Server (if self-hosted)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Deployment"}),": ",(0,t.jsx)(n.code,{children:"livekit"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Service"}),": ",(0,t.jsx)(n.code,{children:"livekit:7880"})," (HTTP), ",(0,t.jsx)(n.code,{children:"livekit:7881"})," (RTP/UDP)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Mode"}),": Development mode (",(0,t.jsx)(n.code,{children:"--dev"})," flag)"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"session-management-server",children:"Session Management Server"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Deployment"}),": ",(0,t.jsx)(n.code,{children:"session-management-server"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Service"}),": ",(0,t.jsx)(n.code,{children:"session-management-server:3000"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Service Account"}),": ",(0,t.jsx)(n.code,{children:"session-management-sa"})," (with RBAC permissions)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Capabilities"}),": Creates/manages agent pods dynamically"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"ai-agent-pods-on-demand",children:"AI Agent Pods (On-Demand)"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Created by"}),": Backend server via Kubernetes API"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Image"}),": ",(0,t.jsx)(n.code,{children:"conversational-ai-server:latest"})]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Lifecycle"}),": Created per session, auto-deleted when stopped"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Resources"}),": 512Mi-2Gi RAM, 250m-1000m CPU"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"useful-commands",children:"Useful Commands"}),"\n",(0,t.jsx)(n.h3,{id:"view-resources",children:"View Resources"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View all resources\nkubectl get all -n ai-agents\n\n# View agent pods\nkubectl get pods -n ai-agents -l app=conversational-ai-agent\n\n# View backend logs\nkubectl logs -f -n ai-agents -l app=session-management-server\n\n# View specific agent logs\nkubectl logs -n ai-agents <agent-pod-name>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"database-access",children:"Database Access"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n ai-agents svc/postgres 5432:5432\n# Then connect with: postgresql://app:app@localhost:5432/app\n"})}),"\n",(0,t.jsx)(n.h3,{id:"scaling",children:"Scaling"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl scale deployment session-management-server -n ai-agents --replicas=3\n"})}),"\n",(0,t.jsx)(n.h2,{id:"resource-limits",children:"Resource Limits"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Component"}),(0,t.jsx)(n.th,{children:"Request"}),(0,t.jsx)(n.th,{children:"Limit"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"PostgreSQL"}),(0,t.jsx)(n.td,{children:"256Mi/250m CPU"}),(0,t.jsx)(n.td,{children:"512Mi/500m CPU"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"LiveKit"}),(0,t.jsx)(n.td,{children:"256Mi/250m CPU"}),(0,t.jsx)(n.td,{children:"1Gi/1000m CPU"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Backend"}),(0,t.jsx)(n.td,{children:"512Mi/250m CPU"}),(0,t.jsx)(n.td,{children:"1Gi/1000m CPU"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Agent"}),(0,t.jsx)(n.td,{children:"512Mi/250m CPU"}),(0,t.jsx)(n.td,{children:"2Gi/1000m CPU"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"minikube-wont-start",children:"minikube Won't Start"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Delete and recreate cluster\nminikube delete\nminikube start --driver=docker --cpus=4 --memory=8192\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pods-stuck-in-imagepullbackoff",children:"Pods Stuck in ImagePullBackOff"}),"\n",(0,t.jsx)(n.p,{children:"Images must be built in minikube's Docker daemon:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"eval $(minikube docker-env)\ndocker build -t session-management-server:latest .\ndocker build -t conversational-ai-server:latest ./conversational-ai-server-python\n"})}),"\n",(0,t.jsx)(n.h3,{id:"backend-cant-create-agent-pods",children:"Backend Can't Create Agent Pods"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check RBAC permissions\nkubectl get role,rolebinding -n ai-agents\n\n# Check service account\nkubectl get serviceaccount -n ai-agents\n\n# View backend logs\nkubectl logs -f -n ai-agents -l app=session-management-server\n"})}),"\n",(0,t.jsx)(n.h3,{id:"agent-pod-fails-to-start",children:"Agent Pod Fails to Start"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# View pod status\nkubectl get pods -n ai-agents -l app=conversational-ai-agent\n\n# View pod logs\nkubectl logs -n ai-agents <agent-pod-name>\n\n# Describe pod for events\nkubectl describe pod -n ai-agents <agent-pod-name>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"database-migration-fails",children:"Database Migration Fails"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it -n ai-agents deployment/session-management-server -- npx prisma migrate deploy\n"})}),"\n",(0,t.jsx)(n.h2,{id:"stopping-the-cluster",children:"Stopping the Cluster"}),"\n",(0,t.jsx)(n.h3,{id:"stop-port-forwarding",children:"Stop Port Forwarding"}),"\n",(0,t.jsxs)(n.p,{children:["Press ",(0,t.jsx)(n.code,{children:"Ctrl+C"})," in the terminal running the startup script."]}),"\n",(0,t.jsx)(n.h3,{id:"stop-minikube",children:"Stop minikube"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"minikube stop\n"})}),"\n",(0,t.jsx)(n.h3,{id:"delete-everything",children:"Delete Everything"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Delete namespace (removes all resources)\nkubectl delete namespace ai-agents\n\n# Or delete entire cluster\nminikube delete\n"})}),"\n",(0,t.jsx)(n.h2,{id:"development-workflow",children:"Development Workflow"}),"\n",(0,t.jsx)(n.h3,{id:"make-code-changes",children:"Make Code Changes"}),"\n",(0,t.jsxs)(n.p,{children:["Edit your source code in ",(0,t.jsx)(n.code,{children:"session-management-server/"})," or ",(0,t.jsx)(n.code,{children:"conversational-ai-server-python/"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"rebuild-images",children:"Rebuild Images"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"eval $(minikube docker-env)\ndocker build -t session-management-server:latest .\ndocker build -t conversational-ai-server:latest ./conversational-ai-server-python\n"})}),"\n",(0,t.jsx)(n.h3,{id:"restart-deployment",children:"Restart Deployment"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl rollout restart deployment/session-management-server -n ai-agents\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-logs",children:"View Logs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -f -n ai-agents -l app=session-management-server\n"})}),"\n",(0,t.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/architecture/database",children:"Database Schema"})," - PostgreSQL data model"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/deployment/production",children:"Production Deployment"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/deployment/nginx-setup",children:"Nginx Setup"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/integration/livekit",children:"LiveKit Integration"})}),"\n"]})]})}function x(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},7054(e,n,s){s.d(n,{HC:()=>l,Ey:()=>d});s(2076);var i=s(6540),t=s(4848);const r={user:{id:"user",label:"User",sublabel:"Browser",description:"End user interacting via voice (microphone) or text input through the web interface. Audio is captured and streamed via WebRTC.",color:"#22c55e"},livekit:{id:"livekit",label:"LiveKit",sublabel:"WebRTC SFU",description:"External WebRTC SFU server (LiveKit Cloud or self-hosted). Handles real-time audio streaming between users and agents. Manages rooms, participant tokens, and media routing.",color:"#f59e0b"},llm:{id:"llm",label:"LLM API",sublabel:"OpenAI / Ollama",description:"External Large Language Model API. Agents send conversation context and receive streaming text responses for natural dialogue generation.",color:"#8b5cf6"},frontend:{id:"frontend",label:"Frontend",sublabel:"React :5173",description:"React/Vite application with LiveKit SDK. Handles session management UI, audio visualization, chat interface, and agent status display.",color:"#3b82f6"},backend:{id:"backend",label:"Backend",sublabel:"NestJS :3000",description:"NestJS control plane. Manages projects, sessions, agent lifecycle. Generates LiveKit tokens, orchestrates K8s pods, handles WebSocket events.",color:"#a855f7"},postgres:{id:"postgres",label:"PostgreSQL",sublabel:":5432",description:"Database via Prisma ORM. Stores projects, sessions, participants, messages with speaker attribution, and agent configurations.",color:"#06b6d4"},agent:{id:"agent",label:"Agent Pod",sublabel:"Python",description:"Ephemeral K8s pod running stella-agent or stella-light. Created per session. Receives audio from LiveKit, processes via STT\u2192LLM\u2192TTS pipeline, streams responses back.",color:"#ec4899"},stt:{id:"stt",label:"STT",sublabel:"Sherpa / Whisper",description:"Speech-to-Text gRPC service. Supports Sherpa-ONNX for low-latency streaming recognition or OpenAI Whisper for higher accuracy transcription.",color:"#14b8a6"},tts:{id:"tts",label:"TTS",sublabel:"Kokoro / Edge",description:"Text-to-Speech gRPC service. Supports Kokoro for local synthesis or EdgeTTS for cloud-based Microsoft voices.",color:"#f472b6"}};function l(){const[e,n]=(0,i.useState)(null),s=e?r[e]:null,l=n=>e===n,a=(e,n)=>l(e)||n&&l(n)?"#a855f7":"#52525b",d=(e,n)=>l(e)||n&&l(n)?"url(#arrow-active)":"url(#arrow)",o=({id:e,x:s,y:i,w:a,h:d})=>{const o=r[e],c=l(e);return(0,t.jsxs)("g",{onMouseEnter:()=>n(e),onMouseLeave:()=>n(null),style:{cursor:"pointer"},children:[(0,t.jsx)("rect",{x:s,y:i,width:a,height:d,rx:"8",fill:c?o.color:"rgba(28, 25, 23, 0.9)",stroke:o.color,strokeWidth:c?2.5:1.5}),(0,t.jsx)("text",{x:s+a/2,y:i+d/2-(o.sublabel?4:0),fill:c?"#fff":"#fafafa",fontSize:"11",fontWeight:"600",textAnchor:"middle",children:o.label}),o.sublabel&&(0,t.jsx)("text",{x:s+a/2,y:i+d/2+10,fill:c?"rgba(255,255,255,0.8)":"#71717a",fontSize:"7",textAnchor:"middle",fontFamily:"monospace",children:o.sublabel})]})};return(0,t.jsxs)("div",{className:"architecture-diagram",children:[(0,t.jsxs)("svg",{viewBox:"0 0 680 300",className:"architecture-diagram__svg",children:[(0,t.jsxs)("defs",{children:[(0,t.jsx)("marker",{id:"arrow",markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",children:(0,t.jsx)("polygon",{points:"0 0, 8 3, 0 6",fill:"#52525b"})}),(0,t.jsx)("marker",{id:"arrow-active",markerWidth:"8",markerHeight:"6",refX:"7",refY:"3",orient:"auto",children:(0,t.jsx)("polygon",{points:"0 0, 8 3, 0 6",fill:"#a855f7"})})]}),(0,t.jsx)("rect",{x:"265",y:"5",width:"150",height:"50",rx:"6",fill:"rgba(245, 158, 11, 0.05)",stroke:"#f59e0b",strokeWidth:"1",strokeDasharray:"4,2"}),(0,t.jsx)("text",{x:"340",y:"18",fill:"#f59e0b",fontSize:"8",textAnchor:"middle",fontWeight:"500",children:"External"}),(0,t.jsx)(o,{id:"livekit",x:280,y:22,w:120,h:28}),(0,t.jsx)("rect",{x:"5",y:"80",width:"70",height:"90",rx:"6",fill:"rgba(34, 197, 94, 0.05)",stroke:"#22c55e",strokeWidth:"1",strokeDasharray:"4,2"}),(0,t.jsx)("text",{x:"40",y:"93",fill:"#22c55e",fontSize:"8",textAnchor:"middle",fontWeight:"500",children:"External"}),(0,t.jsx)(o,{id:"user",x:12,y:100,w:56,h:60}),(0,t.jsx)("rect",{x:"605",y:"80",width:"70",height:"90",rx:"6",fill:"rgba(139, 92, 246, 0.05)",stroke:"#8b5cf6",strokeWidth:"1",strokeDasharray:"4,2"}),(0,t.jsx)("text",{x:"640",y:"93",fill:"#8b5cf6",fontSize:"8",textAnchor:"middle",fontWeight:"500",children:"External"}),(0,t.jsx)(o,{id:"llm",x:612,y:100,w:56,h:60}),(0,t.jsx)("rect",{x:"85",y:"65",width:"510",height:"230",rx:"10",fill:"rgba(59, 130, 246, 0.02)",stroke:"#3b82f6",strokeWidth:"1.5"}),(0,t.jsx)("text",{x:"340",y:"82",fill:"#3b82f6",fontSize:"10",textAnchor:"middle",fontWeight:"600",children:"Kubernetes Cluster"}),(0,t.jsx)("rect",{x:"95",y:"92",width:"490",height:"195",rx:"6",fill:"transparent",stroke:"rgba(59, 130, 246, 0.2)",strokeWidth:"1",strokeDasharray:"4,3"}),(0,t.jsx)("text",{x:"340",y:"106",fill:"#52525b",fontSize:"8",textAnchor:"middle",fontFamily:"monospace",children:"namespace: ai-agents"}),(0,t.jsx)(o,{id:"frontend",x:110,y:120,w:95,h:45}),(0,t.jsx)(o,{id:"backend",x:240,y:120,w:95,h:45}),(0,t.jsx)(o,{id:"agent",x:430,y:115,w:110,h:55}),(0,t.jsx)(o,{id:"postgres",x:240,y:200,w:95,h:45}),(0,t.jsx)(o,{id:"stt",x:365,y:210,w:95,h:40}),(0,t.jsx)(o,{id:"tts",x:475,y:210,w:95,h:40}),(0,t.jsx)("line",{x1:"68",y1:"130",x2:"110",y2:"140",stroke:a("user","frontend"),strokeWidth:"1.5",markerEnd:d("user","frontend")}),(0,t.jsx)("text",{x:"82",y:"127",fill:"#71717a",fontSize:"7",children:"HTTP"}),(0,t.jsx)("path",{d:"M 40 100 L 40 60 Q 40 36 60 36 L 280 36",fill:"none",stroke:a("user","livekit"),strokeWidth:"1.5",markerEnd:d("user","livekit")}),(0,t.jsx)("text",{x:"150",y:"30",fill:"#71717a",fontSize:"7",children:"WebRTC"}),(0,t.jsx)("line",{x1:"205",y1:"142",x2:"240",y2:"142",stroke:a("frontend","backend"),strokeWidth:"1.5",markerEnd:d("frontend","backend")}),(0,t.jsx)("text",{x:"222",y:"136",fill:"#71717a",fontSize:"7",children:"REST"}),(0,t.jsx)("line",{x1:"287",y1:"165",x2:"287",y2:"200",stroke:a("backend","postgres"),strokeWidth:"1.5",markerEnd:d("backend","postgres")}),(0,t.jsx)("text",{x:"298",y:"185",fill:"#71717a",fontSize:"7",children:"Prisma"}),(0,t.jsx)("line",{x1:"335",y1:"142",x2:"430",y2:"142",stroke:a("backend","agent"),strokeWidth:"1.5",markerEnd:d("backend","agent")}),(0,t.jsx)("text",{x:"380",y:"136",fill:"#71717a",fontSize:"7",children:"K8s API"}),(0,t.jsx)("path",{d:"M 400 36 L 485 36 Q 510 36 510 60 L 510 115",fill:"none",stroke:a("livekit","agent"),strokeWidth:"1.5",markerEnd:d("livekit","agent")}),(0,t.jsx)("text",{x:"455",y:"30",fill:"#71717a",fontSize:"7",children:"Audio"}),(0,t.jsx)("line",{x1:"540",y1:"142",x2:"612",y2:"130",stroke:a("agent","llm"),strokeWidth:"1.5",markerEnd:d("agent","llm")}),(0,t.jsx)("text",{x:"570",y:"128",fill:"#71717a",fontSize:"7",children:"API"}),(0,t.jsx)("line",{x1:"460",y1:"170",x2:"413",y2:"210",stroke:a("agent","stt"),strokeWidth:"1.5",markerEnd:d("agent","stt")}),(0,t.jsx)("text",{x:"428",y:"192",fill:"#71717a",fontSize:"7",children:"gRPC"}),(0,t.jsx)("line",{x1:"510",y1:"170",x2:"523",y2:"210",stroke:a("agent","tts"),strokeWidth:"1.5",markerEnd:d("agent","tts")}),(0,t.jsx)("text",{x:"525",y:"192",fill:"#71717a",fontSize:"7",children:"gRPC"})]}),(0,t.jsx)("div",{className:"architecture-diagram__info "+(s?"architecture-diagram__info--visible":""),children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"architecture-diagram__info-badge",style:{backgroundColor:s.color},children:[s.label,s.sublabel&&(0,t.jsx)("span",{style:{opacity:.8,marginLeft:"8px",fontSize:"0.85em"},children:s.sublabel})]}),(0,t.jsx)("p",{className:"architecture-diagram__info-description",children:s.description})]}):(0,t.jsx)("p",{className:"architecture-diagram__info-hint",children:"Hover over a component to see details"})})]})}var a=s(8774);function d({category:e,text:n="Environment Variables Reference",description:s}){const i=e?`/docs/architecture/environment-variables#${e}`:"/docs/architecture/environment-variables";return(0,t.jsxs)("div",{className:"env-var-reference",children:[(0,t.jsx)("div",{className:"env-var-reference__icon",children:(0,t.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,t.jsx)("path",{d:"M4 19.5A2.5 2.5 0 0 1 6.5 17H20"}),(0,t.jsx)("path",{d:"M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"})]})}),(0,t.jsxs)("div",{className:"env-var-reference__content",children:[(0,t.jsx)(a.A,{to:i,className:"env-var-reference__link",children:n}),s&&(0,t.jsx)("p",{className:"env-var-reference__description",children:s})]})]})}}}]);