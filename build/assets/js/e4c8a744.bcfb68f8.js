"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[7989],{1931(e,n,t){t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"guides/authentication","title":"Authentication","description":"STELLA uses JWT-based authentication to secure API endpoints and manage user access to projects.","source":"@site/docs/guides/authentication.md","sourceDirName":"guides","slug":"/guides/authentication","permalink":"/STELLA_backend/docs/guides/authentication","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/guides/authentication.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Authentication"},"sidebar":"docsSidebar","previous":{"title":"Custom Agent Visualizers","permalink":"/STELLA_backend/docs/guides/add-custom-ui"},"next":{"title":"Architecture Overview","permalink":"/STELLA_backend/docs/architecture/overview"}}');var s=t(4848),r=t(8453);const d={sidebar_position:4,title:"Authentication"},l="Authentication",a={},c=[{value:"Overview",id:"overview",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Database Schema",id:"database-schema",level:2},{value:"User Model",id:"user-model",level:3},{value:"Project Membership",id:"project-membership",level:3},{value:"API Endpoints",id:"api-endpoints",level:2},{value:"Public Endpoints",id:"public-endpoints",level:3},{value:"Protected Endpoints",id:"protected-endpoints",level:3},{value:"Usage",id:"usage",level:2},{value:"1. Sign Up",id:"1-sign-up",level:3},{value:"2. Log In",id:"2-log-in",level:3},{value:"3. Use Token in Requests",id:"3-use-token-in-requests",level:3},{value:"4. Create Project with Auth",id:"4-create-project-with-auth",level:3},{value:"Frontend Integration",id:"frontend-integration",level:2},{value:"Store Token After Login",id:"store-token-after-login",level:3},{value:"Include Token in Requests",id:"include-token-in-requests",level:3},{value:"Security Features",id:"security-features",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Database Migration",id:"database-migration",level:3},{value:"Project Access Control",id:"project-access-control",level:2},{value:"Migration Strategy",id:"migration-strategy",level:2},{value:"Option A: Gradual Rollout",id:"option-a-gradual-rollout",level:3},{value:"Option B: Immediate Enforcement",id:"option-b-immediate-enforcement",level:3},{value:"Future Enhancements",id:"future-enhancements",level:2},{value:"See Also",id:"see-also",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"authentication",children:"Authentication"})}),"\n",(0,s.jsx)(n.p,{children:"STELLA uses JWT-based authentication to secure API endpoints and manage user access to projects."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The authentication system provides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User registration and login"})," with email/password"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"JWT tokens"})," for stateless authentication"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Role-based access control"})," via project memberships"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Global route protection"})," with public route exceptions"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"src/\n\u251c\u2500\u2500 auth/\n\u2502   \u251c\u2500\u2500 auth.module.ts           # Auth module configuration\n\u2502   \u251c\u2500\u2500 auth.service.ts          # Signup, login, password hashing\n\u2502   \u251c\u2500\u2500 auth.controller.ts       # Auth endpoints\n\u2502   \u251c\u2500\u2500 dto/\n\u2502   \u2502   \u251c\u2500\u2500 signup.dto.ts        # Signup validation\n\u2502   \u2502   \u2514\u2500\u2500 login.dto.ts         # Login validation\n\u2502   \u251c\u2500\u2500 strategies/\n\u2502   \u2502   \u2514\u2500\u2500 jwt.strategy.ts      # JWT validation\n\u2502   \u2514\u2500\u2500 guards/\n\u2502       \u251c\u2500\u2500 jwt-auth.guard.ts    # Route protection\n\u2502       \u2514\u2500\u2500 project-access.guard.ts  # Project-level access\n\u251c\u2500\u2500 common/\n\u2502   \u2514\u2500\u2500 decorators/\n\u2502       \u251c\u2500\u2500 current-user.decorator.ts  # Extract user from request\n\u2502       \u2514\u2500\u2500 public.decorator.ts        # Mark routes as public\n"})}),"\n",(0,s.jsx)(n.h2,{id:"database-schema",children:"Database Schema"}),"\n",(0,s.jsxs)(n.p,{children:["See ",(0,s.jsx)(n.a,{href:"/docs/architecture/database",children:"Database Schema"})," for the complete data model. Key models for authentication:"]}),"\n",(0,s.jsx)(n.h3,{id:"user-model",children:"User Model"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:"model User {\n  id          String   @id @default(uuid())\n  email       String   @unique\n  password    String   // bcrypt hashed\n  name        String\n  createdAt   DateTime @default(now())\n\n  projectMemberships ProjectMembership[]\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"project-membership",children:"Project Membership"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-prisma",children:"model ProjectMembership {\n  id        String     @id @default(uuid())\n  userId    String\n  projectId String\n  role      MemberRole @default(MEMBER)\n\n  user      User       @relation(fields: [userId], references: [id])\n  project   Project    @relation(fields: [projectId], references: [id])\n\n  @@unique([userId, projectId])\n}\n\nenum MemberRole {\n  OWNER\n  ADMIN\n  MEMBER\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"api-endpoints",children:"API Endpoints"}),"\n",(0,s.jsx)(n.h3,{id:"public-endpoints",children:"Public Endpoints"}),"\n",(0,s.jsx)(n.p,{children:"These endpoints don't require authentication:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Endpoint"}),(0,s.jsx)(n.th,{children:"Method"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/auth/signup"})}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"Register a new user"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/auth/login"})}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"Authenticate and get token"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/health"})}),(0,s.jsx)(n.td,{children:"GET"}),(0,s.jsx)(n.td,{children:"Health check"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/"})}),(0,s.jsx)(n.td,{children:"GET"}),(0,s.jsx)(n.td,{children:"Root endpoint"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"protected-endpoints",children:"Protected Endpoints"}),"\n",(0,s.jsx)(n.p,{children:"All other endpoints require a valid JWT token:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Endpoint"}),(0,s.jsx)(n.th,{children:"Method"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/auth/me"})}),(0,s.jsx)(n.td,{children:"GET"}),(0,s.jsx)(n.td,{children:"Get current user info"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/projects"})}),(0,s.jsx)(n.td,{children:"GET"}),(0,s.jsx)(n.td,{children:"List user's projects"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/projects"})}),(0,s.jsx)(n.td,{children:"POST"}),(0,s.jsx)(n.td,{children:"Create a new project"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/projects/:id"})}),(0,s.jsx)(n.td,{children:"GET"}),(0,s.jsx)(n.td,{children:"Get project details"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"/sessions/:id"})}),(0,s.jsx)(n.td,{children:"GET"}),(0,s.jsx)(n.td,{children:"Get session details"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.h3,{id:"1-sign-up",children:"1. Sign Up"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:3000/auth/signup \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "email": "user@example.com",\n    "password": "SecurePass123!",\n    "name": "John Doe"\n  }\'\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "user": {\n    "id": "uuid",\n    "email": "user@example.com",\n    "name": "John Doe",\n    "createdAt": "2025-10-03T..."\n  },\n  "token": "eyJhbGciOiJIUzI1NiIs..."\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-log-in",children:"2. Log In"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:3000/auth/login \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "email": "user@example.com",\n    "password": "SecurePass123!"\n  }\'\n'})}),"\n",(0,s.jsx)(n.h3,{id:"3-use-token-in-requests",children:"3. Use Token in Requests"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl http://localhost:3000/auth/me \\\n  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIs..."\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Response:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "id": "uuid",\n  "email": "user@example.com",\n  "name": "John Doe",\n  "createdAt": "2025-10-03T...",\n  "projectMemberships": []\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"4-create-project-with-auth",children:"4. Create Project with Auth"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:3000/projects \\\n  -H "Authorization: Bearer YOUR_TOKEN" \\\n  -H "Content-Type: application/json" \\\n  -d \'{"name": "My Project"}\'\n'})}),"\n",(0,s.jsx)(n.h2,{id:"frontend-integration",children:"Frontend Integration"}),"\n",(0,s.jsx)(n.h3,{id:"store-token-after-login",children:"Store Token After Login"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const { token } = await api.post('/auth/signup', {\n  email: 'user@example.com',\n  password: 'SecurePass123!',\n  name: 'John Doe'\n});\n\nlocalStorage.setItem('jwt', token);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"include-token-in-requests",children:"Include Token in Requests"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"const api = {\n  async get(path: string) {\n    const token = localStorage.getItem('jwt');\n    const response = await fetch(`${API_URL}${path}`, {\n      headers: {\n        'Authorization': `Bearer ${token}`\n      }\n    });\n    return response.json();\n  },\n\n  async post(path: string, data: any) {\n    const token = localStorage.getItem('jwt');\n    const response = await fetch(`${API_URL}${path}`, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${token}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(data)\n    });\n    return response.json();\n  }\n};\n"})}),"\n",(0,s.jsx)(n.h2,{id:"security-features",children:"Security Features"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Feature"}),(0,s.jsx)(n.th,{children:"Status"}),(0,s.jsx)(n.th,{children:"Notes"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Password hashing"}),(0,s.jsx)(n.td,{children:"Implemented"}),(0,s.jsx)(n.td,{children:"bcrypt with 12 rounds"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"JWT tokens"}),(0,s.jsx)(n.td,{children:"Implemented"}),(0,s.jsx)(n.td,{children:"7-day expiration"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Global authentication"}),(0,s.jsx)(n.td,{children:"Implemented"}),(0,s.jsx)(n.td,{children:"All routes protected by default"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Role-based access"}),(0,s.jsx)(n.td,{children:"Implemented"}),(0,s.jsx)(n.td,{children:"Via ProjectMembership"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Input validation"}),(0,s.jsx)(n.td,{children:"Implemented"}),(0,s.jsx)(n.td,{children:"On all DTOs"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Token blacklist"}),(0,s.jsx)(n.td,{children:"Not implemented"}),(0,s.jsx)(n.td,{children:"For logout functionality"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Rate limiting"}),(0,s.jsx)(n.td,{children:"Not implemented"}),(0,s.jsx)(n.td,{children:"Recommended for production"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Password strength"}),(0,s.jsx)(n.td,{children:"Basic"}),(0,s.jsx)(n.td,{children:"Minimum length only"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# JWT Configuration\nJWT_SECRET=your-secret-key-here\nJWT_EXPIRATION=7d\n"})}),"\n",(0,s.jsx)(n.h3,{id:"database-migration",children:"Database Migration"}),"\n",(0,s.jsx)(n.p,{children:"After modifying the schema:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Create and apply migration\nnpx prisma migrate dev --name add_authentication\n\n# Regenerate Prisma client\nnpx prisma generate\n"})}),"\n",(0,s.jsx)(n.h2,{id:"project-access-control",children:"Project Access Control"}),"\n",(0,s.jsx)(n.p,{children:"When creating a project, the user automatically becomes the OWNER:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// In projects.service.ts\nasync create(userId: string, createProjectDto: CreateProjectDto) {\n  return this.prisma.project.create({\n    data: {\n      ...createProjectDto,\n      memberships: {\n        create: {\n          userId,\n          role: 'OWNER',\n        },\n      },\n    },\n  });\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Filter projects by user access:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"async findAll(userId: string) {\n  const memberships = await this.prisma.projectMembership.findMany({\n    where: { userId },\n    select: { projectId: true },\n  });\n\n  const projectIds = memberships.map(m => m.projectId);\n\n  return this.prisma.project.findMany({\n    where: {\n      id: { in: projectIds },\n    },\n  });\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,s.jsx)(n.h3,{id:"option-a-gradual-rollout",children:"Option A: Gradual Rollout"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Make auth optional initially (remove global guard)"}),"\n",(0,s.jsx)(n.li,{children:"Allow time for clients to update"}),"\n",(0,s.jsx)(n.li,{children:"Enable auth enforcement after migration period"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"option-b-immediate-enforcement",children:"Option B: Immediate Enforcement"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Deploy with auth enabled"}),"\n",(0,s.jsx)(n.li,{children:"Provide migration guide"}),"\n",(0,s.jsx)(n.li,{children:"Create default admin user for existing deployments"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"future-enhancements",children:"Future Enhancements"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Password reset via email"}),"\n",(0,s.jsx)(n.li,{children:"Refresh tokens with rotation"}),"\n",(0,s.jsx)(n.li,{children:"Email verification"}),"\n",(0,s.jsx)(n.li,{children:"MFA/2FA support"}),"\n",(0,s.jsx)(n.li,{children:"OAuth integration (Google, GitHub)"}),"\n",(0,s.jsx)(n.li,{children:"Rate limiting on auth endpoints"}),"\n",(0,s.jsx)(n.li,{children:"API keys for programmatic access"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/architecture/database",children:"Database Schema"})," - Complete data model"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/integration/frontend",children:"Frontend Integration"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"/docs/architecture/environment-variables",children:"Environment Variables"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>d,x:()=>l});var i=t(6540);const s={},r=i.createContext(s);function d(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);