"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[7787],{5227(e,n,o){o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"deployment/reverse-proxy","title":"\ud83d\udd00 Reverse Proxy","description":"Complete guide for deploying STELLA with a reverse proxy, supporting both path-based and subdomain-based routing.","source":"@site/docs/deployment/reverse-proxy.md","sourceDirName":"deployment","slug":"/deployment/reverse-proxy","permalink":"/STELLA_backend/docs/deployment/reverse-proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/deployment/reverse-proxy.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"\ud83d\udd00 Reverse Proxy"}}');var i=o(4848),t=o(8453);const s={sidebar_position:4,title:"\ud83d\udd00 Reverse Proxy"},a="\ud83d\udd00 Reverse Proxy Deployment",d={},l=[{value:"Routing Options",id:"routing-options",level:2},{value:"Option 1: Subdomain-Based Routing (Recommended)",id:"option-1-subdomain-based-routing-recommended",level:3},{value:"Option 2: Path-Based Routing",id:"option-2-path-based-routing",level:3},{value:"Subdomain-Based Setup",id:"subdomain-based-setup",level:2},{value:"DNS Configuration",id:"dns-configuration",level:3},{value:"Nginx Configuration",id:"nginx-configuration",level:3},{value:"Backend Configuration",id:"backend-configuration",level:3},{value:"Frontend Configuration",id:"frontend-configuration",level:3},{value:"Path-Based Setup",id:"path-based-setup",level:2},{value:"DNS Configuration",id:"dns-configuration-1",level:3},{value:"Nginx Configuration",id:"nginx-configuration-1",level:3},{value:"Backend Configuration",id:"backend-configuration-1",level:3},{value:"Frontend Configuration",id:"frontend-configuration-1",level:3},{value:"SSL/HTTPS Setup",id:"sslhttps-setup",level:2},{value:"Let&#39;s Encrypt with Certbot",id:"lets-encrypt-with-certbot",level:3},{value:"Wildcard Certificate (DNS challenge)",id:"wildcard-certificate-dns-challenge",level:3},{value:"Testing &amp; Verification",id:"testing--verification",level:2},{value:"Local Service Tests",id:"local-service-tests",level:3},{value:"Public HTTPS Tests",id:"public-https-tests",level:3},{value:"Browser Tests",id:"browser-tests",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"502 Bad Gateway",id:"502-bad-gateway",level:3},{value:"CORS Errors",id:"cors-errors",level:3},{value:"404 Not Found (API routes)",id:"404-not-found-api-routes",level:3},{value:"WebSocket Connection Failed",id:"websocket-connection-failed",level:3},{value:"SSL Certificate Errors",id:"ssl-certificate-errors",level:3},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-reverse-proxy-deployment",children:"\ud83d\udd00 Reverse Proxy Deployment"})}),"\n",(0,i.jsx)(n.p,{children:"Complete guide for deploying STELLA with a reverse proxy, supporting both path-based and subdomain-based routing."}),"\n",(0,i.jsx)(n.h2,{id:"routing-options",children:"Routing Options"}),"\n",(0,i.jsx)(n.h3,{id:"option-1-subdomain-based-routing-recommended",children:"Option 1: Subdomain-Based Routing (Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"Clean separation of services:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Frontend:  https://yourdomain.com/\nAPI:       https://api.yourdomain.com/\nLiveKit:   wss://livekit.yourdomain.com\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Clean URL structure"}),"\n",(0,i.jsx)(n.li,{children:"No path conflicts"}),"\n",(0,i.jsx)(n.li,{children:"Better WebSocket support"}),"\n",(0,i.jsx)(n.li,{children:"Easier to scale separately"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Multiple DNS records required"}),"\n",(0,i.jsx)(n.li,{children:"Wildcard SSL or multiple certificates"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"option-2-path-based-routing",children:"Option 2: Path-Based Routing"}),"\n",(0,i.jsx)(n.p,{children:"All services on one domain:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Frontend:  https://yourdomain.com/\nAPI:       https://yourdomain.com/api/\nLiveKit:   wss://yourdomain.com/livekit\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Single SSL certificate"}),"\n",(0,i.jsx)(n.li,{children:"Single DNS record"}),"\n",(0,i.jsx)(n.li,{children:"Simpler DNS management"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"More complex Nginx configuration"}),"\n",(0,i.jsx)(n.li,{children:"Potential path conflicts"}),"\n",(0,i.jsx)(n.li,{children:"WebSocket complications possible"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"subdomain-based-setup",children:"Subdomain-Based Setup"}),"\n",(0,i.jsx)(n.h3,{id:"dns-configuration",children:"DNS Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Add A records:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Type: A,  Name: @,       Value: YOUR_SERVER_IP\nType: A,  Name: api,     Value: YOUR_SERVER_IP\nType: A,  Name: livekit, Value: YOUR_SERVER_IP\n"})}),"\n",(0,i.jsx)(n.p,{children:"Or use wildcard:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Type: A,  Name: *,       Value: YOUR_SERVER_IP\n"})}),"\n",(0,i.jsx)(n.h3,{id:"nginx-configuration",children:"Nginx Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'# Frontend - yourdomain.com\nserver {\n    listen 443 ssl http2;\n    server_name yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n\n# API - api.yourdomain.com\nserver {\n    listen 443 ssl http2;\n    server_name api.yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    location / {\n        proxy_pass http://127.0.0.1:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n\n# LiveKit - livekit.yourdomain.com\nserver {\n    listen 443 ssl http2;\n    server_name livekit.yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    location / {\n        proxy_pass http://127.0.0.1:7880;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n        proxy_set_header Host $host;\n        proxy_buffering off;\n\n        # WebSocket timeouts\n        proxy_connect_timeout 7d;\n        proxy_send_timeout 7d;\n        proxy_read_timeout 7d;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"backend-configuration",children:"Backend Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# .env\nNODE_ENV=production\nPORT=3000\n\nCORS_ORIGIN=https://yourdomain.com,https://api.yourdomain.com\n\nPUBLIC_SERVER_URL=https://api.yourdomain.com\nPUBLIC_LIVEKIT_URL=wss://livekit.yourdomain.com\n"})}),"\n",(0,i.jsx)(n.h3,{id:"frontend-configuration",children:"Frontend Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# .env.production\nVITE_API_URL=https://api.yourdomain.com\nVITE_LIVEKIT_URL=wss://livekit.yourdomain.com\n"})}),"\n",(0,i.jsx)(n.h2,{id:"path-based-setup",children:"Path-Based Setup"}),"\n",(0,i.jsx)(n.h3,{id:"dns-configuration-1",children:"DNS Configuration"}),"\n",(0,i.jsx)(n.p,{children:"Single A record:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Type: A,  Name: @,  Value: YOUR_SERVER_IP\n"})}),"\n",(0,i.jsx)(n.h3,{id:"nginx-configuration-1",children:"Nginx Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 443 ssl http2;\n    server_name yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    # Security Headers\n    add_header X-Frame-Options "SAMEORIGIN" always;\n    add_header X-Content-Type-Options "nosniff" always;\n    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;\n\n    # API routes\n    location ~ ^/(auth|projects|sessions|agents|health) {\n        proxy_pass http://127.0.0.1:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # Internal APIs\n    location /internal/ {\n        proxy_pass http://127.0.0.1:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n    }\n\n    # LiveKit WebSocket\n    location /livekit {\n        proxy_pass http://127.0.0.1:7880;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n        proxy_set_header Host $host;\n        proxy_buffering off;\n\n        proxy_connect_timeout 7d;\n        proxy_send_timeout 7d;\n        proxy_read_timeout 7d;\n    }\n\n    # Frontend - Everything else\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \'upgrade\';\n        proxy_set_header Host $host;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"backend-configuration-1",children:"Backend Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# .env\nNODE_ENV=production\nPORT=3000\n\nCORS_ORIGIN=https://yourdomain.com\n\nPUBLIC_SERVER_URL=https://yourdomain.com\nPUBLIC_LIVEKIT_URL=wss://yourdomain.com/livekit\n"})}),"\n",(0,i.jsx)(n.h3,{id:"frontend-configuration-1",children:"Frontend Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# .env.production\nVITE_API_URL=https://yourdomain.com\nVITE_LIVEKIT_URL=wss://yourdomain.com/livekit\n"})}),"\n",(0,i.jsx)(n.h2,{id:"sslhttps-setup",children:"SSL/HTTPS Setup"}),"\n",(0,i.jsx)(n.h3,{id:"lets-encrypt-with-certbot",children:"Let's Encrypt with Certbot"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install certbot\nsudo apt update\nsudo apt install certbot python3-certbot-nginx -y\n\n# Get certificate\nsudo certbot certonly --nginx \\\n  -d yourdomain.com \\\n  -d api.yourdomain.com \\\n  -d livekit.yourdomain.com \\\n  --email your-email@example.com \\\n  --agree-tos\n\n# Test auto-renewal\nsudo certbot renew --dry-run\n"})}),"\n",(0,i.jsx)(n.h3,{id:"wildcard-certificate-dns-challenge",children:"Wildcard Certificate (DNS challenge)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sudo certbot certonly --dns-cloudflare \\\n  -d "*.yourdomain.com" \\\n  -d yourdomain.com \\\n  --email your-email@example.com \\\n  --agree-tos\n'})}),"\n",(0,i.jsx)(n.h2,{id:"testing--verification",children:"Testing & Verification"}),"\n",(0,i.jsx)(n.h3,{id:"local-service-tests",children:"Local Service Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:3000/health   # Backend\ncurl http://localhost:8080          # Frontend\ncurl http://localhost:7880          # LiveKit\n"})}),"\n",(0,i.jsx)(n.h3,{id:"public-https-tests",children:"Public HTTPS Tests"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Frontend\ncurl -I https://yourdomain.com\n\n# API\ncurl -I https://api.yourdomain.com/health\n# or\ncurl -I https://yourdomain.com/health\n\n# LiveKit (returns 400 but proves connectivity)\ncurl -I https://livekit.yourdomain.com\n"})}),"\n",(0,i.jsx)(n.h3,{id:"browser-tests",children:"Browser Tests"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open ",(0,i.jsx)(n.code,{children:"https://yourdomain.com"})]}),"\n",(0,i.jsx)(n.li,{children:"Check SSL padlock icon"}),"\n",(0,i.jsx)(n.li,{children:"Open DevTools \u2192 Network tab"}),"\n",(0,i.jsx)(n.li,{children:"Verify API calls use correct URLs"}),"\n",(0,i.jsx)(n.li,{children:"Check WebSocket connection to LiveKit"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"502-bad-gateway",children:"502 Bad Gateway"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check backend is running\npm2 status\ncurl http://localhost:3000/health\n\n# Restart if needed\npm2 restart stella-backend\n"})}),"\n",(0,i.jsx)(n.h3,{id:"cors-errors",children:"CORS Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check CORS_ORIGIN in backend .env\ncat .env | grep CORS_ORIGIN\n\n# Should match your domain exactly\nCORS_ORIGIN=https://yourdomain.com\n"})}),"\n",(0,i.jsx)(n.h3,{id:"404-not-found-api-routes",children:"404 Not Found (API routes)"}),"\n",(0,i.jsx)(n.p,{children:"Check that API routes are configured in Nginx:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'sudo nginx -T | grep "location"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"websocket-connection-failed",children:"WebSocket Connection Failed"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Check LiveKit is running\ncurl http://localhost:7880\n\n# Check Nginx has WebSocket headers\nsudo nginx -T | grep -A 10 "livekit"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"ssl-certificate-errors",children:"SSL Certificate Errors"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Check certificate\nsudo certbot certificates\n\n# Renew if needed\nsudo certbot renew\n\n# Reload Nginx\nsudo systemctl reload nginx\n"})}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/deployment/nginx-setup",children:"Nginx Setup"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/deployment/production",children:"Production Deployment"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/integration/livekit-production",children:"LiveKit Production"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453(e,n,o){o.d(n,{R:()=>s,x:()=>a});var r=o(6540);const i={},t=r.createContext(i);function s(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);