"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[3591],{6404(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>r});const t=JSON.parse('{"id":"sdk/base-agent","title":"Base Agent","description":"BaseAgent class reference","source":"@site/docs/sdk/base-agent.md","sourceDirName":"sdk","slug":"/sdk/base-agent","permalink":"/STELLA_backend/docs/sdk/base-agent","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/sdk/base-agent.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Base Agent","description":"BaseAgent class reference"},"sidebar":"docsSidebar","previous":{"title":"SDK Overview","permalink":"/STELLA_backend/docs/sdk/overview"},"next":{"title":"Message Types","permalink":"/STELLA_backend/docs/sdk/message-types"}}');var i=s(4848),a=s(8453);const d={sidebar_position:2,title:"Base Agent",description:"BaseAgent class reference"},l="Base Agent",c={},r=[{value:"Class Definition",id:"class-definition",level:2},{value:"Lifecycle Methods",id:"lifecycle-methods",level:2},{value:"<code>on_connect()</code>",id:"on_connect",level:3},{value:"<code>on_disconnect()</code>",id:"on_disconnect",level:3},{value:"<code>on_shutdown()</code>",id:"on_shutdown",level:3},{value:"Audio Methods",id:"audio-methods",level:2},{value:"<code>on_transcript(text, is_final)</code>",id:"on_transcripttext-is_final",level:3},{value:"<code>on_audio_frame(frame)</code>",id:"on_audio_frameframe",level:3},{value:"<code>publish_audio(chunk)</code>",id:"publish_audiochunk",level:3},{value:"<code>speak(text)</code>",id:"speaktext",level:3},{value:"Data Channel Methods",id:"data-channel-methods",level:2},{value:"<code>on_data_message(message)</code>",id:"on_data_messagemessage",level:3},{value:"<code>send_data(data)</code>",id:"send_datadata",level:3},{value:"Status Methods",id:"status-methods",level:2},{value:"<code>send_status(status, message?)</code>",id:"send_statusstatus-message",level:3},{value:"<code>send_transcript(text, speaker, is_final?)</code>",id:"send_transcripttext-speaker-is_final",level:3},{value:"Participant Methods",id:"participant-methods",level:2},{value:"<code>on_participant_joined(participant)</code>",id:"on_participant_joinedparticipant",level:3},{value:"<code>on_participant_left(participant)</code>",id:"on_participant_leftparticipant",level:3},{value:"Tool Methods",id:"tool-methods",level:2},{value:"<code>register_tool(func)</code>",id:"register_toolfunc",level:3},{value:"<code>get_tool_definitions()</code>",id:"get_tool_definitions",level:3},{value:"<code>execute_tool(name, args)</code>",id:"execute_toolname-args",level:3},{value:"Properties",id:"properties",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Running the Agent",id:"running-the-agent",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"base-agent",children:"Base Agent"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"BaseAgent"})," class is the foundation for all STELLA agents. It handles LiveKit connection, audio streaming, and provides hooks for implementing conversation logic."]}),"\n",(0,i.jsx)(n.h2,{id:"class-definition",children:"Class Definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from stella_sdk import BaseAgent\n\nclass MyAgent(BaseAgent):\n    async def on_connect(self):\n        """Called when connected to the LiveKit room."""\n        pass\n\n    async def on_transcript(self, text: str, is_final: bool):\n        """Called when speech is transcribed."""\n        pass\n\n    async def on_disconnect(self):\n        """Called when disconnecting from the room."""\n        pass\n'})}),"\n",(0,i.jsx)(n.h2,{id:"lifecycle-methods",children:"Lifecycle Methods"}),"\n",(0,i.jsx)(n.h3,{id:"on_connect",children:(0,i.jsx)(n.code,{children:"on_connect()"})}),"\n",(0,i.jsx)(n.p,{children:"Called when the agent successfully connects to the LiveKit room."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_connect(self):\n    print(f"Connected to room: {self.room_name}")\n\n    # Send initial greeting\n    await self.speak("Hello! How can I help you today?")\n\n    # Initialize conversation state\n    self.history = []\n    self.context = await self.load_context()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"on_disconnect",children:(0,i.jsx)(n.code,{children:"on_disconnect()"})}),"\n",(0,i.jsx)(n.p,{children:"Called when the agent is disconnecting. Use for cleanup."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_disconnect(self):\n    # Save conversation state\n    await self.save_conversation()\n\n    # Clean up resources\n    await self.pipeline.close()\n\n    print("Session ended")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"on_shutdown",children:(0,i.jsx)(n.code,{children:"on_shutdown()"})}),"\n",(0,i.jsx)(n.p,{children:"Called when the agent receives a shutdown signal (SIGTERM)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_shutdown(self):\n    # Graceful shutdown logic\n    await self.send_status("ending", "Session ending...")\n    await self.save_state()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"audio-methods",children:"Audio Methods"}),"\n",(0,i.jsx)(n.h3,{id:"on_transcripttext-is_final",children:(0,i.jsx)(n.code,{children:"on_transcript(text, is_final)"})}),"\n",(0,i.jsx)(n.p,{children:"Called when the STT engine produces transcription."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Parameter"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"text"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"str"})}),(0,i.jsx)(n.td,{children:"Transcribed text"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"is_final"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:"Whether this is a final result"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_transcript(self, text: str, is_final: bool):\n    # Send interim transcripts to frontend\n    await self.send_transcript(text, speaker="user", is_final=is_final)\n\n    # Only process final transcripts\n    if not is_final:\n        return\n\n    # Process the user\'s input\n    response = await self.generate_response(text)\n    await self.speak(response)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"on_audio_frameframe",children:(0,i.jsx)(n.code,{children:"on_audio_frame(frame)"})}),"\n",(0,i.jsxs)(n.p,{children:["Called for each audio frame received. Rarely needed - use ",(0,i.jsx)(n.code,{children:"on_transcript"})," instead."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"async def on_audio_frame(self, frame: AudioFrame):\n    # Raw audio processing (advanced usage)\n    self.audio_buffer.append(frame)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"publish_audiochunk",children:(0,i.jsx)(n.code,{children:"publish_audio(chunk)"})}),"\n",(0,i.jsx)(n.p,{children:"Publish audio to the LiveKit room."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"async def publish_audio(self, chunk: bytes):\n    # Publish raw audio bytes\n    await self.room.local_participant.publish_data(chunk)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"speaktext",children:(0,i.jsx)(n.code,{children:"speak(text)"})}),"\n",(0,i.jsx)(n.p,{children:"Convenience method for TTS and publishing. Override to customize."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def speak(self, text: str):\n    # Send transcript to frontend\n    await self.send_transcript(text, speaker="assistant")\n\n    # Convert to speech and publish\n    async for chunk in self.pipeline.text_to_speech_stream(text):\n        await self.publish_audio(chunk)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"data-channel-methods",children:"Data Channel Methods"}),"\n",(0,i.jsx)(n.h3,{id:"on_data_messagemessage",children:(0,i.jsx)(n.code,{children:"on_data_message(message)"})}),"\n",(0,i.jsx)(n.p,{children:"Called when a data channel message is received."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_data_message(self, message: dict):\n    msg_type = message.get("type")\n\n    if msg_type == "user_text":\n        # Handle text input like voice\n        await self.on_transcript(message["data"], is_final=True)\n\n    elif msg_type == "control":\n        action = message["data"].get("action")\n        if action == "interrupt":\n            await self.handle_interrupt()\n        elif action == "pause":\n            await self.handle_pause()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"send_datadata",children:(0,i.jsx)(n.code,{children:"send_data(data)"})}),"\n",(0,i.jsx)(n.p,{children:"Send data to all participants in the room."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'await self.send_data({\n    "type": "custom",\n    "data": {"key": "value"}\n})\n'})}),"\n",(0,i.jsx)(n.h2,{id:"status-methods",children:"Status Methods"}),"\n",(0,i.jsx)(n.h3,{id:"send_statusstatus-message",children:(0,i.jsx)(n.code,{children:"send_status(status, message?)"})}),"\n",(0,i.jsx)(n.p,{children:"Send a status update to the frontend."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Status"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"listening"})}),(0,i.jsx)(n.td,{children:"Waiting for user input"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"thinking"})}),(0,i.jsx)(n.td,{children:"Processing/generating response"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"speaking"})}),(0,i.jsx)(n.td,{children:"Playing TTS audio"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"idle"})}),(0,i.jsx)(n.td,{children:"Not actively processing"})]})]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'await self.send_status("thinking", "Searching the database...")\nawait self.send_status("speaking")\nawait self.send_status("listening")\n'})}),"\n",(0,i.jsx)(n.h3,{id:"send_transcripttext-speaker-is_final",children:(0,i.jsx)(n.code,{children:"send_transcript(text, speaker, is_final?)"})}),"\n",(0,i.jsx)(n.p,{children:"Send a transcript message."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'await self.send_transcript(\n    text="Hello, how can I help?",\n    speaker="assistant",\n    is_final=True\n)\n'})}),"\n",(0,i.jsx)(n.h2,{id:"participant-methods",children:"Participant Methods"}),"\n",(0,i.jsx)(n.h3,{id:"on_participant_joinedparticipant",children:(0,i.jsx)(n.code,{children:"on_participant_joined(participant)"})}),"\n",(0,i.jsx)(n.p,{children:"Called when a user joins the room."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_participant_joined(self, participant: Participant):\n    print(f"User joined: {participant.identity}")\n\n    if participant.identity != "agent":\n        await self.greet_user(participant)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"on_participant_leftparticipant",children:(0,i.jsx)(n.code,{children:"on_participant_left(participant)"})}),"\n",(0,i.jsx)(n.p,{children:"Called when a user leaves the room."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'async def on_participant_left(self, participant: Participant):\n    print(f"User left: {participant.identity}")\n\n    # Check if room is empty\n    if len(self.room.participants) == 1:  # Only agent left\n        await self.handle_empty_room()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"tool-methods",children:"Tool Methods"}),"\n",(0,i.jsx)(n.h3,{id:"register_toolfunc",children:(0,i.jsx)(n.code,{children:"register_tool(func)"})}),"\n",(0,i.jsx)(n.p,{children:"Register a function as a tool."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'from stella_sdk import tool\n\n@tool\nasync def search(query: str) -> dict:\n    """Search the database."""\n    return {"results": [...]}\n\nclass MyAgent(BaseAgent):\n    def __init__(self):\n        super().__init__()\n        self.register_tool(search)\n'})}),"\n",(0,i.jsx)(n.h3,{id:"get_tool_definitions",children:(0,i.jsx)(n.code,{children:"get_tool_definitions()"})}),"\n",(0,i.jsx)(n.p,{children:"Get OpenAI-compatible tool definitions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"tools = self.get_tool_definitions()\n# Returns list of tool schemas for LLM\n"})}),"\n",(0,i.jsx)(n.h3,{id:"execute_toolname-args",children:(0,i.jsx)(n.code,{children:"execute_tool(name, args)"})}),"\n",(0,i.jsx)(n.p,{children:"Execute a registered tool."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'result = await self.execute_tool("search", {"query": "STELLA docs"})\n'})}),"\n",(0,i.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Property"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"room"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Room"})}),(0,i.jsx)(n.td,{children:"LiveKit room instance"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"room_name"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"str"})}),(0,i.jsx)(n.td,{children:"Name of the room"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"session_id"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"str"})}),(0,i.jsx)(n.td,{children:"Session identifier"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"participant_identity"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"str"})}),(0,i.jsx)(n.td,{children:"Agent's identity"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"is_connected"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"bool"})}),(0,i.jsx)(n.td,{children:"Connection status"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.p,{children:"BaseAgent reads configuration from environment variables:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'class BaseAgent:\n    def __init__(self):\n        self.livekit_url = os.getenv("LIVEKIT_URL")\n        self.room_name = os.getenv("ROOM_NAME")\n        self.session_id = os.getenv("SESSION_ID")\n        # ...\n'})}),"\n",(0,i.jsx)(n.h2,{id:"running-the-agent",children:"Running the Agent"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:'if __name__ == "__main__":\n    agent = MyAgent()\n    agent.run()  # Blocking call\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"run()"})," method:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Connects to LiveKit"}),"\n",(0,i.jsx)(n.li,{children:"Starts audio processing"}),"\n",(0,i.jsx)(n.li,{children:"Handles events until disconnection"}),"\n",(0,i.jsx)(n.li,{children:"Cleans up resources"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/sdk/message-types",children:"Message Types"})," - Communication protocol"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/sdk/tools",children:"Tools"})," - Building tools"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/sdk/streaming",children:"Streaming"})," - Audio streaming details"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,s){s.d(n,{R:()=>d,x:()=>l});var t=s(6540);const i={},a=t.createContext(i);function d(e){const n=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:d(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);