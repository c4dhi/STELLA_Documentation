"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[4575],{8453(e,n,s){s.d(n,{R:()=>d,x:()=>r});var t=s(6540);const a={},i=t.createContext(a);function d(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),t.createElement(i.Provider,{value:n},e.children)}},8568(e,n,s){s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>d,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"sdk/message-types","title":"Message Types","description":"Communication protocol between agents and frontend","source":"@site/docs/sdk/message-types.md","sourceDirName":"sdk","slug":"/sdk/message-types","permalink":"/STELLA_backend/docs/sdk/message-types","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/sdk/message-types.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Message Types","description":"Communication protocol between agents and frontend"},"sidebar":"docsSidebar","previous":{"title":"Base Agent","permalink":"/STELLA_backend/docs/sdk/base-agent"},"next":{"title":"Tools","permalink":"/STELLA_backend/docs/sdk/tools"}}');var a=s(4848),i=s(8453);const d={sidebar_position:3,title:"Message Types",description:"Communication protocol between agents and frontend"},r="Message Types",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Transcript Messages",id:"transcript-messages",level:2},{value:"Schema",id:"schema",level:3},{value:"Usage (Agent)",id:"usage-agent",level:3},{value:"Usage (Frontend)",id:"usage-frontend",level:3},{value:"Status Messages",id:"status-messages",level:2},{value:"Schema",id:"schema-1",level:3},{value:"Status Values",id:"status-values",level:3},{value:"Usage (Agent)",id:"usage-agent-1",level:3},{value:"Usage (Frontend)",id:"usage-frontend-1",level:3},{value:"Progress Messages",id:"progress-messages",level:2},{value:"Schema",id:"schema-2",level:3},{value:"Usage (Agent)",id:"usage-agent-2",level:3},{value:"Usage (Frontend)",id:"usage-frontend-2",level:3},{value:"Control Messages",id:"control-messages",level:2},{value:"Schema",id:"schema-3",level:3},{value:"Actions",id:"actions",level:3},{value:"Usage (Frontend)",id:"usage-frontend-3",level:3},{value:"Usage (Agent)",id:"usage-agent-3",level:3},{value:"User Text Messages",id:"user-text-messages",level:2},{value:"Schema",id:"schema-4",level:3},{value:"Usage (Frontend)",id:"usage-frontend-4",level:3},{value:"Usage (Agent)",id:"usage-agent-4",level:3},{value:"Custom Messages",id:"custom-messages",level:2},{value:"Example: Form Data",id:"example-form-data",level:3},{value:"Example: UI Updates",id:"example-ui-updates",level:3},{value:"Message Encoding",id:"message-encoding",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"message-types",children:"Message Types"})}),"\n",(0,a.jsx)(n.p,{children:"STELLA uses structured messages for communication between agents and the frontend. Messages are sent over LiveKit data channels."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"All messages follow this structure:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"interface Message {\n  type: string;      // Message type identifier\n  timestamp: number; // Unix timestamp in milliseconds\n  data: any;         // Type-specific payload\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"transcript-messages",children:"Transcript Messages"}),"\n",(0,a.jsx)(n.p,{children:"Used for speech transcription (both interim and final)."}),"\n",(0,a.jsx)(n.h3,{id:"schema",children:"Schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'interface TranscriptMessage {\n  type: "transcript";\n  timestamp: number;\n  data: {\n    speaker: "user" | "assistant";\n    text: string;\n    isFinal: boolean;\n    confidence?: number;  // 0-1, STT confidence\n    language?: string;    // ISO language code\n  };\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"usage-agent",children:"Usage (Agent)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# Send interim transcript (while user is speaking)\nawait self.send_transcript(\n    text="Hello, I would like to",\n    speaker="user",\n    is_final=False\n)\n\n# Send final transcript\nawait self.send_transcript(\n    text="Hello, I would like to order a pizza",\n    speaker="user",\n    is_final=True\n)\n\n# Send assistant response\nawait self.send_transcript(\n    text="I\'d be happy to help you order a pizza!",\n    speaker="assistant",\n    is_final=True\n)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"usage-frontend",children:"Usage (Frontend)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"room.on('dataReceived', (payload) => {\n  const message = JSON.parse(new TextDecoder().decode(payload));\n\n  if (message.type === 'transcript') {\n    const { speaker, text, isFinal } = message.data;\n\n    if (speaker === 'user') {\n      if (isFinal) {\n        addMessage({ speaker: 'user', text });\n      } else {\n        updateInterimTranscript(text);\n      }\n    } else {\n      addMessage({ speaker: 'assistant', text });\n    }\n  }\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"status-messages",children:"Status Messages"}),"\n",(0,a.jsx)(n.p,{children:"Indicate the agent's current state."}),"\n",(0,a.jsx)(n.h3,{id:"schema-1",children:"Schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'interface StatusMessage {\n  type: "status";\n  timestamp: number;\n  data: {\n    status: "listening" | "thinking" | "speaking" | "idle";\n    message?: string;  // Optional descriptive message\n  };\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"status-values",children:"Status Values"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Status"}),(0,a.jsx)(n.th,{children:"Description"}),(0,a.jsx)(n.th,{children:"UI Indication"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"listening"})}),(0,a.jsx)(n.td,{children:"Waiting for user input"}),(0,a.jsx)(n.td,{children:"Microphone active"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"thinking"})}),(0,a.jsx)(n.td,{children:"Processing user input"}),(0,a.jsx)(n.td,{children:"Loading indicator"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"speaking"})}),(0,a.jsx)(n.td,{children:"Playing TTS audio"}),(0,a.jsx)(n.td,{children:"Speaker animation"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"idle"})}),(0,a.jsx)(n.td,{children:"Not actively engaged"}),(0,a.jsx)(n.td,{children:"Ready state"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"usage-agent-1",children:"Usage (Agent)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# Indicate processing\nawait self.send_status("thinking", "Analyzing your request...")\n\n# Indicate speaking\nawait self.send_status("speaking")\n\n# Indicate listening\nawait self.send_status("listening")\n'})}),"\n",(0,a.jsx)(n.h3,{id:"usage-frontend-1",children:"Usage (Frontend)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function AgentStatus({ status, message }) {\n  const indicators = {\n    listening: { icon: <MicIcon />, label: 'Listening' },\n    thinking: { icon: <Spinner />, label: message || 'Thinking' },\n    speaking: { icon: <SpeakerIcon />, label: 'Speaking' },\n    idle: { icon: <CheckIcon />, label: 'Ready' },\n  };\n\n  const current = indicators[status];\n\n  return (\n    <div className=\"agent-status\">\n      {current.icon}\n      <span>{current.label}</span>\n    </div>\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"progress-messages",children:"Progress Messages"}),"\n",(0,a.jsx)(n.p,{children:"Show task progress with a todo list."}),"\n",(0,a.jsx)(n.h3,{id:"schema-2",children:"Schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'interface ProgressMessage {\n  type: "progress";\n  timestamp: number;\n  data: {\n    todos: TodoItem[];\n  };\n}\n\ninterface TodoItem {\n  id: string;\n  description: string;\n  status: "pending" | "in_progress" | "completed";\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"usage-agent-2",children:"Usage (Agent)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'from stella_sdk import TodoItem\n\n# Initialize todo list\nawait self.update_todo([\n    TodoItem(id="1", description="Understand request", status="in_progress"),\n    TodoItem(id="2", description="Search database", status="pending"),\n    TodoItem(id="3", description="Generate response", status="pending"),\n])\n\n# Update progress\nawait self.complete_task("1")\nawait self.start_task("2")\n'})}),"\n",(0,a.jsx)(n.h3,{id:"usage-frontend-2",children:"Usage (Frontend)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'function ProgressList({ todos }) {\n  return (\n    <ul className="progress-list">\n      {todos.map(todo => (\n        <li key={todo.id} className={`todo-${todo.status}`}>\n          <StatusIcon status={todo.status} />\n          <span>{todo.description}</span>\n        </li>\n      ))}\n    </ul>\n  );\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"control-messages",children:"Control Messages"}),"\n",(0,a.jsx)(n.p,{children:"Commands from frontend to agent."}),"\n",(0,a.jsx)(n.h3,{id:"schema-3",children:"Schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'interface ControlMessage {\n  type: "control";\n  timestamp: number;\n  data: {\n    action: "interrupt" | "pause" | "resume" | "stop";\n    payload?: any;\n  };\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"actions",children:"Actions"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Action"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"interrupt"})}),(0,a.jsx)(n.td,{children:"Stop current TTS playback"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"pause"})}),(0,a.jsx)(n.td,{children:"Pause the conversation"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"resume"})}),(0,a.jsx)(n.td,{children:"Resume the conversation"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"stop"})}),(0,a.jsx)(n.td,{children:"End the session"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"usage-frontend-3",children:"Usage (Frontend)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Interrupt agent speech\nroom.localParticipant.publishData(\n  new TextEncoder().encode(JSON.stringify({\n    type: 'control',\n    data: { action: 'interrupt' }\n  }))\n);\n"})}),"\n",(0,a.jsx)(n.h3,{id:"usage-agent-3",children:"Usage (Agent)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'async def on_data_message(self, message: dict):\n    if message.get("type") == "control":\n        action = message["data"]["action"]\n\n        if action == "interrupt":\n            await self.pipeline.cancel_tts()\n            await self.send_status("listening")\n\n        elif action == "pause":\n            self.is_paused = True\n\n        elif action == "resume":\n            self.is_paused = False\n            await self.send_status("listening")\n'})}),"\n",(0,a.jsx)(n.h2,{id:"user-text-messages",children:"User Text Messages"}),"\n",(0,a.jsx)(n.p,{children:"Text input from the user (alternative to voice)."}),"\n",(0,a.jsx)(n.h3,{id:"schema-4",children:"Schema"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'interface UserTextMessage {\n  type: "user_text";\n  timestamp: number;\n  data: string;  // The text message\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"usage-frontend-4",children:"Usage (Frontend)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"function sendTextMessage(text: string) {\n  room.localParticipant.publishData(\n    new TextEncoder().encode(JSON.stringify({\n      type: 'user_text',\n      timestamp: Date.now(),\n      data: text\n    }))\n  );\n}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"usage-agent-4",children:"Usage (Agent)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'async def on_data_message(self, message: dict):\n    if message.get("type") == "user_text":\n        text = message["data"]\n        # Handle same as voice transcript\n        await self.on_transcript(text, is_final=True)\n'})}),"\n",(0,a.jsx)(n.h2,{id:"custom-messages",children:"Custom Messages"}),"\n",(0,a.jsx)(n.p,{children:"You can define custom message types for application-specific needs."}),"\n",(0,a.jsx)(n.h3,{id:"example-form-data",children:"Example: Form Data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// Frontend sends form data\ninterface FormDataMessage {\n  type: "form_data";\n  timestamp: number;\n  data: {\n    formId: string;\n    fields: Record<string, any>;\n  };\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'# Agent handles form data\nasync def on_data_message(self, message: dict):\n    if message.get("type") == "form_data":\n        form_id = message["data"]["formId"]\n        fields = message["data"]["fields"]\n        await self.process_form(form_id, fields)\n'})}),"\n",(0,a.jsx)(n.h3,{id:"example-ui-updates",children:"Example: UI Updates"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:'// Agent sends UI update\ninterface UIUpdateMessage {\n  type: "ui_update";\n  timestamp: number;\n  data: {\n    component: string;\n    props: Record<string, any>;\n  };\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"message-encoding",children:"Message Encoding"}),"\n",(0,a.jsx)(n.p,{children:"Messages are serialized as JSON and encoded as UTF-8:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",children:"// Sending\nconst message = { type: 'transcript', data: { ... } };\nconst encoded = new TextEncoder().encode(JSON.stringify(message));\nroom.localParticipant.publishData(encoded);\n\n// Receiving\nroom.on('dataReceived', (payload) => {\n  const decoded = new TextDecoder().decode(payload);\n  const message = JSON.parse(decoded);\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/sdk/tools",children:"Tools"})," - Building custom tools"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/sdk/streaming",children:"Streaming"})," - Audio streaming"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/docs/sdk/base-agent",children:"Base Agent"})," - Full API reference"]}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}}}]);