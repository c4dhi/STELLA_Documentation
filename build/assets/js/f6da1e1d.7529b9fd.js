"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[871],{3517(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"architecture/database","title":"Database Schema","description":"PostgreSQL database structure with Prisma ORM","source":"@site/docs/architecture/database.md","sourceDirName":"architecture","slug":"/architecture/database","permalink":"/STELLA_backend/docs/architecture/database","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/architecture/database.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Database Schema","description":"PostgreSQL database structure with Prisma ORM"},"sidebar":"docsSidebar","previous":{"title":"Session Lifecycle","permalink":"/STELLA_backend/docs/architecture/session-lifecycle"},"next":{"title":"Kubernetes Orchestration","permalink":"/STELLA_backend/docs/architecture/kubernetes-orchestration"}}');var i=t(4848),a=t(8453);const r={sidebar_position:5,title:"Database Schema",description:"PostgreSQL database structure with Prisma ORM"},d="Database Schema",l={},c=[{value:"Entity Relationship Diagram",id:"entity-relationship-diagram",level:2},{value:"Core Models",id:"core-models",level:2},{value:"User",id:"user",level:3},{value:"Project",id:"project",level:3},{value:"Session",id:"session",level:3},{value:"Agent System",id:"agent-system",level:2},{value:"AgentType",id:"agenttype",level:3},{value:"AgentInstance",id:"agentinstance",level:3},{value:"Session State Machine",id:"session-state-machine",level:2},{value:"SessionState",id:"sessionstate",level:3},{value:"Participants &amp; Invitations",id:"participants--invitations",level:2},{value:"Participant",id:"participant",level:3},{value:"Invitation",id:"invitation",level:3},{value:"Messages &amp; Events",id:"messages--events",level:2},{value:"Message",id:"message",level:3},{value:"RoomEvent",id:"roomevent",level:3},{value:"User Templates",id:"user-templates",level:2},{value:"PlanTemplate",id:"plantemplate",level:3},{value:"EnvVarTemplate",id:"envvartemplate",level:3},{value:"User Messaging",id:"user-messaging",level:2},{value:"UserMessage",id:"usermessage",level:3},{value:"ProjectInvitation",id:"projectinvitation",level:3},{value:"Database Indexes",id:"database-indexes",level:2},{value:"Migrations",id:"migrations",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"database-schema",children:"Database Schema"})}),"\n",(0,i.jsx)(n.p,{children:"STELLA uses PostgreSQL with Prisma ORM for data persistence. This document describes the database structure and relationships between entities."}),"\n",(0,i.jsx)(n.h2,{id:"entity-relationship-diagram",children:"Entity Relationship Diagram"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    User     \u2502\u2500\u2500\u2500\u2500\u2500\u2500<\u2502 ProjectMembership \u2502>\u2500\u2500\u2500\u2500\u2500\u2500\u2502   Project   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n      \u2502                                                  \u2502\n      \u2502 owns                                             \u2502 contains\n      \u25bc                                                  \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                   \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  AgentType  \u2502                                   \u2502   Session   \u2502\n\u2502 PlanTemplate\u2502                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u2502EnvVarTemplat\u2502                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                           \u2502              \u2502             \u2502             \u2502              \u2502\n                           \u25bc              \u25bc             \u25bc             \u25bc              \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502   Room    \u2502  \u2502AgentInstance\u2502 \u2502Particip.\u2502 \u2502 Invitation\u2502 \u2502  Message   \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h2,{id:"core-models",children:"Core Models"}),"\n",(0,i.jsx)(n.h3,{id:"user",children:"User"}),"\n",(0,i.jsx)(n.p,{children:"Represents authenticated users of the platform."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model User {\n  id        String   @id @default(uuid())\n  email     String   @unique\n  password  String   // bcrypt hashed\n  name      String?\n  verified  Boolean  @default(false)\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Relations\n  projectMemberships         ProjectMembership[]\n  customAgentTypes           AgentType[]\n  planTemplates              PlanTemplate[]\n  envVarTemplates            EnvVarTemplate[]\n  messages                   UserMessage[]\n  sentProjectInvitations     ProjectInvitation[]\n  receivedProjectInvitations ProjectInvitation[]\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"project",children:"Project"}),"\n",(0,i.jsx)(n.p,{children:"Organizational container for sessions. Supports public sharing."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model Project {\n  id        String   @id @default(uuid())\n  name      String\n  createdAt DateTime @default(now())\n  updatedAt DateTime @updatedAt\n\n  // Public Project Configuration\n  isPublic               Boolean    @default(false)\n  publicToken            String?    @unique\n  publicAgentTypeId      String?\n  publicAgentConfig      Json?      // { name, icon, plan, envVarTemplateId }\n  publicVisualizerType   String?\n  publicVisualizerLocked Boolean    @default(false)\n  publicExpiresAt        DateTime?\n  publicEnabled          Boolean    @default(true)\n\n  // Relations\n  sessions           Session[]\n  memberships        ProjectMembership[]\n  projectInvitations ProjectInvitation[]\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Member Roles:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Role"}),(0,i.jsx)(n.th,{children:"Permissions"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"OWNER"})}),(0,i.jsx)(n.td,{children:"Full control, delete project, manage members"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ADMIN"})}),(0,i.jsx)(n.td,{children:"Manage sessions, invite members"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"MEMBER"})}),(0,i.jsx)(n.td,{children:"Create and view sessions"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"session",children:"Session"}),"\n",(0,i.jsx)(n.p,{children:"A conversation instance with participants and agents."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model Session {\n  id        String        @id @default(uuid())\n  projectId String\n  name      String?\n  status    SessionStatus @default(ACTIVE) // ACTIVE, CLOSED\n  createdAt DateTime      @default(now())\n  closedAt  DateTime?\n\n  // Relations\n  room         Room?\n  agents       AgentInstance[]\n  participants Participant[]\n  invitations  Invitation[]\n  messages     Message[]\n  events       RoomEvent[]\n  state        SessionState?\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"agent-system",children:"Agent System"}),"\n",(0,i.jsx)(n.h3,{id:"agenttype",children:"AgentType"}),"\n",(0,i.jsx)(n.p,{children:"Registry of available agent types (built-in and custom)."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:'model AgentType {\n  id          String  @id @default(uuid())\n  slug        String  @unique  // "stella-agent", "memory-coach"\n  name        String           // Display name\n  description String\n  icon        String?\n  version     String  @default("1.0.0")\n  isBuiltIn   Boolean @default(true)\n\n  // Custom agent ownership\n  userId String?\n\n  // Package storage (custom agents)\n  packagePath String?\n  packageSize Int?\n  packageHash String?\n\n  // Docker image configuration\n  imageUrl       String?  // Pre-built image URL\n  dockerfilePath String?  // Path within package\n\n  // Validation workflow\n  validationStatus AgentValidationStatus @default(PENDING)\n  validationNotes  String?\n  validatedAt      DateTime?\n  validatedBy      String?\n\n  // Configuration schema (JSON Schema format)\n  configSchema  Json?\n  capabilities  Json?   // ["voice", "text", "progress"]\n  defaultConfig Json?\n\n  // Resource limits\n  resourceMemory String? @default("512Mi")\n  resourceCpu    String? @default("250m")\n  resourceGpu    Boolean @default(false)\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Validation Status:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Status"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PENDING"})}),(0,i.jsx)(n.td,{children:"Awaiting admin review"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"APPROVED"})}),(0,i.jsx)(n.td,{children:"Ready for use"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REJECTED"})}),(0,i.jsx)(n.td,{children:"Failed validation"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"agentinstance",children:"AgentInstance"}),"\n",(0,i.jsx)(n.p,{children:"Running instance of an agent within a session."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:'model AgentInstance {\n  id            String      @id @default(uuid())\n  sessionId     String\n  name          String\n  icon          String?\n  status        AgentStatus @default(STARTING)\n  agentType     String?     @default("stella-agent")\n  agentTypeId   String?\n  agentConfig   Json?\n\n  // Kubernetes resources\n  podName       String?\n  secretName    String?\n  configMapName String?\n\n  // Health tracking\n  healthState       String?   @default("unknown")\n  lastHealthCheck   DateTime?\n  lastError         String?\n  messagesProcessed Int       @default(0)\n  grpcAddress       String?\n\n  // Environment variables\n  envVarTemplateId String?\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Agent Status:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Status"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"STARTING"})}),(0,i.jsx)(n.td,{children:"Pod being created"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"RUNNING"})}),(0,i.jsx)(n.td,{children:"Active and processing"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"STOPPING"})}),(0,i.jsx)(n.td,{children:"Shutdown in progress"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"STOPPED"})}),(0,i.jsx)(n.td,{children:"Cleanly terminated"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"FAILED"})}),(0,i.jsx)(n.td,{children:"Error state"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"session-state-machine",children:"Session State Machine"}),"\n",(0,i.jsx)(n.h3,{id:"sessionstate",children:"SessionState"}),"\n",(0,i.jsx)(n.p,{children:"Persists conversation plan execution state."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:'model SessionState {\n  id        String @id @default(uuid())\n  sessionId String @unique\n\n  // Plan definition\n  planId   String?\n  planData Json    // Full plan (states, tasks, deliverables)\n\n  // Execution state\n  currentStateId String\n  completedTasks String[] @default([])\n  skippedTasks   String[] @default([])\n\n  // Collected deliverables\n  deliverables Json @default("{}")\n  // Format: { key: { value, reasoning, collectedAt } }\n\n  // Progress tracking\n  turnsWithoutProgress Int @default(0)\n  totalTurns           Int @default(0)\n\n  lastTransitionAt DateTime?\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"participants--invitations",children:"Participants & Invitations"}),"\n",(0,i.jsx)(n.h3,{id:"participant",children:"Participant"}),"\n",(0,i.jsx)(n.p,{children:"Users connected to a session via LiveKit."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model Participant {\n  id                   String    @id @default(uuid())\n  sessionId            String\n  name                 String\n  identity             String    // LiveKit identity\n  isManuallyRegistered Boolean   @default(false)\n  joinedAt             DateTime  @default(now())\n  leftAt               DateTime?\n  tokenRevokedAt       DateTime?\n  lastTokenRefresh     DateTime?\n  lastSeenAt           DateTime?\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"invitation",children:"Invitation"}),"\n",(0,i.jsx)(n.p,{children:"Shareable links for session access."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model Invitation {\n  id              String           @id @default(uuid())\n  sessionId       String\n  token           String           @unique // URL token\n  participantName String\n  customMessage   String?\n\n  // Visualizer settings\n  visualizerType   String?\n  visualizerLocked Boolean @default(false)\n\n  // Status\n  status    InvitationStatus @default(PENDING)\n  expiresAt DateTime?\n  acceptedAt DateTime?\n  participantId String? @unique\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Invitation Status:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Status"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"PENDING"})}),(0,i.jsx)(n.td,{children:"Waiting for participant"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ACCEPTED"})}),(0,i.jsx)(n.td,{children:"Participant joined"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"EXPIRED"})}),(0,i.jsx)(n.td,{children:"Time-based expiration"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"REVOKED"})}),(0,i.jsx)(n.td,{children:"Manually revoked"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"messages--events",children:"Messages & Events"}),"\n",(0,i.jsx)(n.h3,{id:"message",children:"Message"}),"\n",(0,i.jsx)(n.p,{children:"Persisted conversation messages and events."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:'model Message {\n  id        String   @id @default(uuid())\n  sessionId String\n  content   String   @db.Text\n  messageType String\n  role      String?  // "user", "assistant", "system"\n  status    String?  // "partial", "final"\n  metadata  Json?\n  timestamp DateTime @default(now())\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Message Types:"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"transcript"})}),(0,i.jsx)(n.td,{children:"Speech-to-text transcription"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"system"})}),(0,i.jsx)(n.td,{children:"System notifications"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"task_update"})}),(0,i.jsx)(n.td,{children:"Plan task progress"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"deliverable"})}),(0,i.jsx)(n.td,{children:"Collected deliverable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"state_change"})}),(0,i.jsx)(n.td,{children:"State machine transition"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"participant_event"})}),(0,i.jsx)(n.td,{children:"Join/leave events"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"roomevent",children:"RoomEvent"}),"\n",(0,i.jsx)(n.p,{children:"LiveKit room events for audit logging."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model RoomEvent {\n  id        String   @id @default(uuid())\n  sessionId String\n  eventType String\n  data      Json\n  timestamp DateTime @default(now())\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"user-templates",children:"User Templates"}),"\n",(0,i.jsx)(n.h3,{id:"plantemplate",children:"PlanTemplate"}),"\n",(0,i.jsx)(n.p,{children:"Reusable conversation plan definitions."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model PlanTemplate {\n  id          String   @id @default(uuid())\n  userId      String\n  name        String\n  description String?\n  content     Json     // SDK format: { states, system_prompt, session_context }\n  createdAt   DateTime @default(now())\n  updatedAt   DateTime @updatedAt\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"envvartemplate",children:"EnvVarTemplate"}),"\n",(0,i.jsx)(n.p,{children:"Secure storage for API keys and secrets."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model EnvVarTemplate {\n  id          String  @id @default(uuid())\n  userId      String\n  name        String\n  description String?\n  variables   String  @db.Text  // AES-256-GCM encrypted JSON\n  agentTypeId String?           // Optional scope to agent type\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Variables are encrypted at rest using AES-256-GCM with the format:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"{iv}:{authTag}:{encryptedData}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"user-messaging",children:"User Messaging"}),"\n",(0,i.jsx)(n.h3,{id:"usermessage",children:"UserMessage"}),"\n",(0,i.jsx)(n.p,{children:"Generic inbox for user notifications."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model UserMessage {\n  id                String          @id @default(uuid())\n  userId            String\n  type              UserMessageType // PROJECT_INVITATION\n  title             String\n  body              String?\n  read              Boolean         @default(false)\n  relatedEntityId   String?\n  relatedEntityType String?\n  createdAt         DateTime        @default(now())\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"projectinvitation",children:"ProjectInvitation"}),"\n",(0,i.jsx)(n.p,{children:"Collaboration invitations between users."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-prisma",children:"model ProjectInvitation {\n  id          String                  @id @default(uuid())\n  projectId   String\n  inviterId   String\n  inviteeId   String\n  status      ProjectInvitationStatus @default(PENDING)\n  respondedAt DateTime?\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"database-indexes",children:"Database Indexes"}),"\n",(0,i.jsx)(n.p,{children:"Key indexes for query performance:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Table"}),(0,i.jsx)(n.th,{children:"Index"}),(0,i.jsx)(n.th,{children:"Purpose"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Session"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"projectId"})}),(0,i.jsx)(n.td,{children:"List sessions by project"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Session"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"status"})}),(0,i.jsx)(n.td,{children:"Filter active sessions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Message"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sessionId, timestamp"})}),(0,i.jsx)(n.td,{children:"Paginated message history"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"AgentInstance"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"status"})}),(0,i.jsx)(n.td,{children:"Monitor running agents"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"Invitation"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"token"})}),(0,i.jsx)(n.td,{children:"Fast token lookup"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"UserMessage"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"userId, read"})}),(0,i.jsx)(n.td,{children:"Unread message count"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"migrations",children:"Migrations"}),"\n",(0,i.jsx)(n.p,{children:"Prisma manages schema migrations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Generate migration from schema changes\nnpx prisma migrate dev --name description\n\n# Apply migrations in production\nnpx prisma migrate deploy\n\n# Reset database (development only)\nnpx prisma migrate reset\n"})}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/architecture/data-flow",children:"Data Flow"})," - How data moves through the system"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/docs/architecture/session-lifecycle",children:"Session Lifecycle"})," - Session states and transitions"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453(e,n,t){t.d(n,{R:()=>r,x:()=>d});var s=t(6540);const i={},a=s.createContext(i);function r(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);