"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[9295],{1588(e,n,r){r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"deployment/nginx-setup","title":"Nginx Setup","description":"Guide for configuring Nginx as a reverse proxy for STELLA in production.","source":"@site/docs/deployment/nginx-setup.md","sourceDirName":"deployment","slug":"/deployment/nginx-setup","permalink":"/STELLA_backend/docs/deployment/nginx-setup","draft":false,"unlisted":false,"editUrl":"https://github.com/c4dhi/STELLA_backend/tree/main/docs-site/docs/deployment/nginx-setup.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"title":"Nginx Setup"},"sidebar":"docsSidebar","previous":{"title":"Kubernetes","permalink":"/STELLA_backend/docs/deployment/kubernetes"},"next":{"title":"Message Recording","permalink":"/STELLA_backend/docs/deployment/message-recording"}}');var o=r(4848),s=r(8453);const i={sidebar_position:3,title:"Nginx Setup"},a="Nginx Configuration",d={},l=[{value:"Routing Options",id:"routing-options",level:2},{value:"Subdomain-Based (Recommended)",id:"subdomain-based-recommended",level:3},{value:"Path-Based",id:"path-based",level:3},{value:"Recommended Approach",id:"recommended-approach",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Basic Nginx Configuration",id:"basic-nginx-configuration",level:2},{value:"Frontend",id:"frontend",level:3},{value:"Backend API",id:"backend-api",level:3},{value:"LiveKit WebSocket",id:"livekit-websocket",level:3},{value:"HTTP to HTTPS Redirect",id:"http-to-https-redirect",level:3},{value:"Complete Configuration Example",id:"complete-configuration-example",level:2},{value:"SSL Certificates with Let&#39;s Encrypt",id:"ssl-certificates-with-lets-encrypt",level:2},{value:"Install Certbot",id:"install-certbot",level:3},{value:"Obtain Certificates",id:"obtain-certificates",level:3},{value:"Auto-Renewal",id:"auto-renewal",level:3},{value:"Deployment Steps",id:"deployment-steps",level:2},{value:"1. Update Nginx Configuration",id:"1-update-nginx-configuration",level:3},{value:"2. Start STELLA in Daemon Mode",id:"2-start-stella-in-daemon-mode",level:3},{value:"3. Verify Port-Forwards",id:"3-verify-port-forwards",level:3},{value:"4. Test Connectivity",id:"4-test-connectivity",level:3},{value:"Automatic Port-Forward Management",id:"automatic-port-forward-management",level:2},{value:"Using Systemd",id:"using-systemd",level:3},{value:"Using Cron",id:"using-cron",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"502 Bad Gateway",id:"502-bad-gateway",level:3},{value:"WebSocket Connection Fails",id:"websocket-connection-fails",level:3},{value:"Port-Forwards Died",id:"port-forwards-died",level:3},{value:"Path-Based Routing Configuration",id:"path-based-routing-configuration",level:2},{value:"DNS Configuration",id:"dns-configuration",level:3},{value:"Nginx Configuration",id:"nginx-configuration-1",level:3},{value:"Backend Environment",id:"backend-environment",level:3},{value:"Frontend Environment",id:"frontend-environment",level:3},{value:"Production Checklist",id:"production-checklist",level:2},{value:"See Also",id:"see-also",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"nginx-configuration",children:"Nginx Configuration"})}),"\n",(0,o.jsx)(n.p,{children:"Guide for configuring Nginx as a reverse proxy for STELLA in production."}),"\n",(0,o.jsx)(n.h2,{id:"routing-options",children:"Routing Options"}),"\n",(0,o.jsx)(n.p,{children:"STELLA supports two deployment modes:"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Option"}),(0,o.jsx)(n.th,{children:"Best For"}),(0,o.jsx)(n.th,{children:"URLs"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Subdomain-based"})}),(0,o.jsx)(n.td,{children:"Production, clean separation"}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"api.domain.com"}),", ",(0,o.jsx)(n.code,{children:"livekit.domain.com"})]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.strong,{children:"Path-based"})}),(0,o.jsx)(n.td,{children:"Single domain, simpler DNS"}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"domain.com/api"}),", ",(0,o.jsx)(n.code,{children:"domain.com/livekit"})]})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"subdomain-based-recommended",children:"Subdomain-Based (Recommended)"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Clean URL structure"}),"\n",(0,o.jsx)(n.li,{children:"No path conflicts"}),"\n",(0,o.jsx)(n.li,{children:"Better WebSocket support"}),"\n",(0,o.jsx)(n.li,{children:"Easier to scale/separate services"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Multiple DNS records required"}),"\n",(0,o.jsx)(n.li,{children:"Wildcard SSL or multiple certificates"}),"\n"]}),"\n",(0,o.jsx)(n.h3,{id:"path-based",children:"Path-Based"}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Pros:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Single SSL certificate"}),"\n",(0,o.jsx)(n.li,{children:"Single DNS A record"}),"\n",(0,o.jsx)(n.li,{children:"Simpler DNS management"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Cons:"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"More complex Nginx configuration"}),"\n",(0,o.jsx)(n.li,{children:"Potential path conflicts"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"recommended-approach",children:"Recommended Approach"}),"\n",(0,o.jsxs)(n.p,{children:["The recommended approach uses ",(0,o.jsx)(n.code,{children:"kubectl port-forward"})," with Nginx:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Internet \u2192 nginx (443) \u2192 localhost:8080/3000/7880 \u2192 kubectl port-forward \u2192 K8s Service \u2192 Pod\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This approach requires ",(0,o.jsx)(n.strong,{children:"no nginx configuration changes"})," if you're already forwarding to localhost ports."]}),"\n",(0,o.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Nginx Reverse Proxy (Host)                   \u2502\n\u2502                  *.yourdomain.com (SSL:443)                     \u2502\n\u2502                           \u2193                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 frontend \u2192 127.0.0.1:8080                                \u2502  \u2502\n\u2502  \u2502 backend  \u2192 127.0.0.1:3000                                \u2502  \u2502\n\u2502  \u2502 livekit  \u2192 127.0.0.1:7880                                \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              Kubernetes Cluster                                  \u2502\n\u2502  kubectl port-forward \u2192 Services \u2192 Pods                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,o.jsx)(n.h2,{id:"basic-nginx-configuration",children:"Basic Nginx Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"frontend",children:"Frontend"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"server {\n    server_name frontend.yourdomain.com;\n\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_pass http://127.0.0.1:8080;\n    }\n\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"backend-api",children:"Backend API"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"server {\n    server_name backend.yourdomain.com;\n\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_pass http://127.0.0.1:3000;\n    }\n\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"livekit-websocket",children:"LiveKit WebSocket"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:'server {\n    server_name livekit.yourdomain.com;\n\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # WebSocket upgrade headers\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n\n        # Long-lived connection timeouts\n        proxy_connect_timeout 7d;\n        proxy_send_timeout 7d;\n        proxy_read_timeout 7d;\n\n        proxy_pass http://127.0.0.1:7880;\n    }\n\n    listen 443 ssl;\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"http-to-https-redirect",children:"HTTP to HTTPS Redirect"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name frontend.yourdomain.com backend.yourdomain.com livekit.yourdomain.com;\n    return 301 https://$host$request_uri;\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"complete-configuration-example",children:"Complete Configuration Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:'# ============================================================================\n# STELLA - Production Nginx Configuration\n# ============================================================================\n\n# Frontend\nserver {\n    server_name frontend.yourdomain.com;\n\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # WebSocket support for hot reload in development\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \'upgrade\';\n        proxy_cache_bypass $http_upgrade;\n\n        proxy_pass http://127.0.0.1:8080;\n    }\n\n    listen 443 ssl http2;\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;\n}\n\n# Backend API\nserver {\n    server_name backend.yourdomain.com;\n\n    # Security headers\n    add_header X-Frame-Options "SAMEORIGIN" always;\n    add_header X-Content-Type-Options "nosniff" always;\n    add_header X-XSS-Protection "1; mode=block" always;\n\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n\n        proxy_pass http://127.0.0.1:3000;\n    }\n\n    listen 443 ssl http2;\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;\n}\n\n# LiveKit WebSocket\nserver {\n    server_name livekit.yourdomain.com;\n\n    location / {\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # WebSocket upgrade\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n\n        # Long-lived WebSocket connections\n        proxy_connect_timeout 7d;\n        proxy_send_timeout 7d;\n        proxy_read_timeout 7d;\n        proxy_buffering off;\n\n        proxy_pass http://127.0.0.1:7880;\n    }\n\n    listen 443 ssl http2;\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n    include /etc/letsencrypt/options-ssl-nginx.conf;\n    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;\n}\n\n# HTTP to HTTPS redirects\nserver {\n    listen 80;\n    server_name frontend.yourdomain.com;\n    return 301 https://$host$request_uri;\n}\n\nserver {\n    listen 80;\n    server_name backend.yourdomain.com;\n    return 301 https://$host$request_uri;\n}\n\nserver {\n    listen 80;\n    server_name livekit.yourdomain.com;\n    return 301 https://$host$request_uri;\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"ssl-certificates-with-lets-encrypt",children:"SSL Certificates with Let's Encrypt"}),"\n",(0,o.jsx)(n.h3,{id:"install-certbot",children:"Install Certbot"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install certbot python3-certbot-nginx -y\n"})}),"\n",(0,o.jsx)(n.h3,{id:"obtain-certificates",children:"Obtain Certificates"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo certbot certonly --nginx \\\n  -d frontend.yourdomain.com \\\n  -d backend.yourdomain.com \\\n  -d livekit.yourdomain.com \\\n  --email your-email@example.com \\\n  --agree-tos\n"})}),"\n",(0,o.jsx)(n.h3,{id:"auto-renewal",children:"Auto-Renewal"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Test renewal\nsudo certbot renew --dry-run\n\n# Check timer\nsudo systemctl status certbot.timer\n"})}),"\n",(0,o.jsx)(n.h2,{id:"deployment-steps",children:"Deployment Steps"}),"\n",(0,o.jsx)(n.h3,{id:"1-update-nginx-configuration",children:"1. Update Nginx Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Create configuration\nsudo nano /etc/nginx/sites-available/stella\n\n# Enable site\nsudo ln -s /etc/nginx/sites-available/stella /etc/nginx/sites-enabled/\n\n# Test configuration\nsudo nginx -t\n\n# Reload nginx\nsudo systemctl reload nginx\n"})}),"\n",(0,o.jsx)(n.h3,{id:"2-start-stella-in-daemon-mode",children:"2. Start STELLA in Daemon Mode"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"./scripts/start-k8s.sh --production --daemon\n"})}),"\n",(0,o.jsx)(n.h3,{id:"3-verify-port-forwards",children:"3. Verify Port-Forwards"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"./scripts/monitor-port-forwards.sh --status\n"})}),"\n",(0,o.jsx)(n.h3,{id:"4-test-connectivity",children:"4. Test Connectivity"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Test locally\ncurl http://localhost:8080   # Frontend\ncurl http://localhost:3000/health  # Backend\n\n# Test through nginx\ncurl https://frontend.yourdomain.com\ncurl https://backend.yourdomain.com/health\n"})}),"\n",(0,o.jsx)(n.h2,{id:"automatic-port-forward-management",children:"Automatic Port-Forward Management"}),"\n",(0,o.jsx)(n.h3,{id:"using-systemd",children:"Using Systemd"}),"\n",(0,o.jsxs)(n.p,{children:["Create ",(0,o.jsx)(n.code,{children:"/etc/systemd/system/stella-port-forwards.service"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ini",children:"[Unit]\nDescription=STELLA Port Forwards\nAfter=network.target\n\n[Service]\nType=simple\nUser=your-username\nWorkingDirectory=/path/to/stella-backend\nExecStart=/path/to/stella-backend/scripts/monitor-port-forwards.sh\nRestart=always\nRestartSec=10\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,o.jsx)(n.p,{children:"Enable:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\nsudo systemctl enable stella-port-forwards\nsudo systemctl start stella-port-forwards\n"})}),"\n",(0,o.jsx)(n.h3,{id:"using-cron",children:"Using Cron"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"crontab -e\n\n# Add:\n* * * * * /path/to/stella-backend/scripts/monitor-port-forwards.sh --once >> /tmp/stella-ai-k8s/cron.log 2>&1\n"})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"502-bad-gateway",children:"502 Bad Gateway"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Check port-forwards\n./scripts/monitor-port-forwards.sh --status\n\n# Test local connectivity\ncurl http://localhost:8080\ncurl http://localhost:3000/health\n\n# Check Kubernetes pods\nkubectl get pods -n ai-agents\n"})}),"\n",(0,o.jsx)(n.h3,{id:"websocket-connection-fails",children:"WebSocket Connection Fails"}),"\n",(0,o.jsx)(n.p,{children:"Verify WebSocket headers and timeouts:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'sudo nginx -T | grep -A 10 "location / {"\n'})}),"\n",(0,o.jsx)(n.h3,{id:"port-forwards-died",children:"Port-Forwards Died"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Restart manually\n./scripts/monitor-port-forwards.sh --restart\n\n# Or use systemd\nsudo systemctl restart stella-port-forwards\n"})}),"\n",(0,o.jsx)(n.h2,{id:"path-based-routing-configuration",children:"Path-Based Routing Configuration"}),"\n",(0,o.jsx)(n.p,{children:"If you prefer path-based routing on a single domain:"}),"\n",(0,o.jsx)(n.h3,{id:"dns-configuration",children:"DNS Configuration"}),"\n",(0,o.jsx)(n.p,{children:"Add a single A record:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"Type: A\nName: @\nValue: YOUR_SERVER_IP\n"})}),"\n",(0,o.jsx)(n.h3,{id:"nginx-configuration-1",children:"Nginx Configuration"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-nginx",children:'# HTTP - Redirect to HTTPS\nserver {\n    listen 80;\n    listen [::]:80;\n    server_name yourdomain.com;\n\n    location /.well-known/acme-challenge/ {\n        root /var/www/certbot;\n    }\n\n    location / {\n        return 301 https://$server_name$request_uri;\n    }\n}\n\n# HTTPS - Main Configuration\nserver {\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    server_name yourdomain.com;\n\n    # SSL Configuration\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n\n    # Security Headers\n    add_header X-Frame-Options "SAMEORIGIN" always;\n    add_header X-Content-Type-Options "nosniff" always;\n    add_header X-XSS-Protection "1; mode=block" always;\n    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;\n\n    # Backend API routes\n    location ~ ^/(auth|projects|sessions|agents|health|network-info) {\n        proxy_pass http://127.0.0.1:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # Internal APIs (Python services)\n    location /internal/ {\n        proxy_pass http://127.0.0.1:3000;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # LiveKit WebSocket\n    location /livekit {\n        proxy_pass http://127.0.0.1:7880;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection "upgrade";\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        proxy_connect_timeout 7d;\n        proxy_send_timeout 7d;\n        proxy_read_timeout 7d;\n        proxy_buffering off;\n    }\n\n    # Frontend - Everything else\n    location / {\n        proxy_pass http://127.0.0.1:8080;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \'upgrade\';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n    }\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"backend-environment",children:"Backend Environment"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"NODE_ENV=production\nPORT=3000\nCORS_ORIGIN=https://yourdomain.com\nPUBLIC_SERVER_URL=https://yourdomain.com\nPUBLIC_LIVEKIT_URL=wss://yourdomain.com/livekit\nLIVEKIT_URL=ws://localhost:7880\n"})}),"\n",(0,o.jsx)(n.h3,{id:"frontend-environment",children:"Frontend Environment"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"VITE_API_URL=https://yourdomain.com\nVITE_LIVEKIT_URL=wss://yourdomain.com/livekit\n"})}),"\n",(0,o.jsx)(n.h2,{id:"production-checklist",children:"Production Checklist"}),"\n",(0,o.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","DNS records configured and verified"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","SSL certificates installed and auto-renewing"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Backend ",(0,o.jsx)(n.code,{children:".env"})," configured for production"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Frontend built with production URLs"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Nginx configuration tested (",(0,o.jsx)(n.code,{children:"nginx -t"}),")"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Firewall allows ports 80, 443"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Services running with PM2 or systemd"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","PM2 configured to start on boot"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","CORS configured for specific domain"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Internal APIs not publicly accessible"]}),"\n",(0,o.jsxs)(n.li,{className:"task-list-item",children:[(0,o.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Monitoring and logging configured"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/deployment/production-checklist",children:"Production Checklist"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/integration/livekit-production",children:"LiveKit Production"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"/docs/architecture/environment-variables",children:"Environment Variables"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}},8453(e,n,r){r.d(n,{R:()=>i,x:()=>a});var t=r(6540);const o={},s=t.createContext(o);function i(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);